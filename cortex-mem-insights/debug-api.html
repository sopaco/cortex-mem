<!DOCTYPE html>
<html>
<head>
    <title>API Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>API Debug Tool</h1>
    
    <h2>Test 1: Direct API Call</h2>
    <button onclick="testDirectAPI()">Test Direct API Call</button>
    <div id="direct-result"></div>
    
    <h2>Test 2: Through Vite Proxy</h2>
    <button onclick="testProxyAPI()">Test Through Vite Proxy</button>
    <div id="proxy-result"></div>
    
    <h2>Test 3: Check Network</h2>
    <button onclick="checkNetwork()">Check Network Status</button>
    <div id="network-result"></div>
    
    <script>
        async function testDirectAPI() {
            const resultDiv = document.getElementById('direct-result');
            resultDiv.innerHTML = '<p>Testing direct API call...</p>';
            
            try {
                const response = await fetch('http://localhost:3001/api/memories');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <p class="success">✅ Direct API call successful!</p>
                    <p><strong>Total:</strong> ${data.total}</p>
                    <p><strong>Memories:</strong> ${data.memories.length}</p>
                    <pre>${JSON.stringify(data.memories[0], null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">❌ Direct API call failed: ${error.message}</p>
                `;
            }
        }
        
        async function testProxyAPI() {
            const resultDiv = document.getElementById('proxy-result');
            resultDiv.innerHTML = '<p>Testing through Vite proxy...</p>';
            
            try {
                const response = await fetch('/api/memories');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <p class="success">✅ Proxy API call successful!</p>
                    <p><strong>Total:</strong> ${data.total}</p>
                    <p><strong>Memories:</strong> ${data.memories.length}</p>
                    <pre>${JSON.stringify(data.memories[0], null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">❌ Proxy API call failed: ${error.message}</p>
                `;
            }
        }
        
        async function checkNetwork() {
            const resultDiv = document.getElementById('network-result');
            resultDiv.innerHTML = '<p>Checking network status...</p>';
            
            try {
                // Check if we can reach the API server
                const apiCheck = await fetch('http://localhost:3001/health');
                const apiStatus = await apiCheck.json();
                
                // Check if Vite proxy is working
                const proxyCheck = await fetch('/health');
                const proxyStatus = await proxyCheck.json();
                
                resultDiv.innerHTML = `
                    <p class="success">✅ Network check complete!</p>
                    <h3>Direct API:</h3>
                    <p><strong>Status:</strong> ${apiStatus.status}</p>
                    <h3>Vite Proxy:</h3>
                    <p><strong>Status:</strong> ${proxyStatus.status}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">❌ Network check failed: ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>
# ğŸ—‚ï¸ Cortex Memory å››ç»´ç©ºé—´è®¾è®¡ä¸ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ ¸å¿ƒé—®é¢˜

**ä»€ä¹ˆæ—¶å€™è¦å­˜åˆ° agentsï¼Œä»€ä¹ˆæ—¶å€™è¦å­˜åˆ° threads é‡Œï¼Ÿæ­£ç¡®çš„é€‰æ‹©ä¾æ®å’Œä½¿ç”¨æ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ**

---

## ğŸŒ Cortex Memory çš„å››ç»´ç©ºé—´æ¶æ„

Cortex Memory è®¾è®¡äº†å››ä¸ªç‹¬ç«‹çš„ç»´åº¦ï¼ˆdimensionsï¼‰ï¼Œæ¯ä¸ªç»´åº¦æœ‰ä¸åŒçš„ç”¨é€”å’Œè¯­ä¹‰ï¼š

```
cortex://
â”œâ”€â”€ agents/          # Agent ç»´åº¦ - Agent çš„ä¸“å±ç©ºé—´
â”œâ”€â”€ users/           # User ç»´åº¦ - ç”¨æˆ·çš„ä¸“å±ç©ºé—´
â”œâ”€â”€ threads/         # Thread ç»´åº¦ - å¯¹è¯çº¿ç¨‹ç©ºé—´
â””â”€â”€ global/          # Global ç»´åº¦ - å…¨å±€å…±äº«ç©ºé—´
```

---

## ğŸ¯ æ¯ä¸ªç»´åº¦çš„è®¾è®¡æ„å›¾

### 1. `cortex://agents/{agent_id}/` - Agent ç»´åº¦

**è®¾è®¡æ„å›¾**ï¼šå­˜å‚¨ **Agent è‡ªèº«çš„çŸ¥è¯†ã€æŠ€èƒ½ã€é…ç½®å’Œå­¦ä¹ å†…å®¹**

**åº”è¯¥å­˜å‚¨çš„å†…å®¹**ï¼š
- âœ… Agent çš„ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰
- âœ… Agent çš„è§’è‰²è®¾å®šå’Œäººæ ¼é…ç½®
- âœ… Agent å­¦ä¹ åˆ°çš„é¢†åŸŸçŸ¥è¯†ï¼ˆé€šè¿‡ RAG ç­‰æ–¹å¼ï¼‰
- âœ… Agent çš„å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†
- âœ… Agent çš„æŠ€èƒ½åº“å’Œå·¥å…·é…ç½®
- âœ… Agent çš„æ€§èƒ½æŒ‡æ ‡å’Œæ—¥å¿—

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
- åˆ›å»ºï¼šAgent è¢«åˆ›å»ºæ—¶åˆå§‹åŒ–
- æ›´æ–°ï¼šAgent å­¦ä¹ æ–°çŸ¥è¯†æ—¶
- åˆ é™¤ï¼šAgent è¢«é”€æ¯æ—¶

**éš”ç¦»æ€§**ï¼š
- ğŸ”’ æ¯ä¸ª Agent æ‹¥æœ‰ç‹¬ç«‹çš„ç©ºé—´
- ğŸ”’ ä¸åŒ Agent ä¹‹é—´å®Œå…¨éš”ç¦»
- ğŸ”’ å³ä½¿åŒä¸€ä¸ªç”¨æˆ·çš„å¤šä¸ª Agentï¼Œä¹Ÿæ˜¯éš”ç¦»çš„

**ç¤ºä¾‹**ï¼š
```
cortex://agents/tars-bot-001/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ system_prompt.md          # ç³»ç»Ÿæç¤ºè¯
â”‚   â”œâ”€â”€ personality.json           # äººæ ¼é…ç½®
â”‚   â””â”€â”€ tools.json                 # å·¥å…·é…ç½®
â”œâ”€â”€ knowledge/
â”‚   â”œâ”€â”€ rust_best_practices.md    # å­¦ä¹ çš„çŸ¥è¯†
â”‚   â”œâ”€â”€ project_context.md        # é¡¹ç›®ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ faq.md                     # å¸¸è§é—®é¢˜
â””â”€â”€ memory/
    â”œâ”€â”€ long_term/                 # é•¿æœŸè®°å¿†
    â”‚   â”œâ”€â”€ facts.md
    â”‚   â””â”€â”€ experiences.md
    â””â”€â”€ working/                   # å·¥ä½œè®°å¿†
        â””â”€â”€ current_task.md
```

---

### 2. `cortex://users/{user_id}/` - User ç»´åº¦

**è®¾è®¡æ„å›¾**ï¼šå­˜å‚¨ **ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€åå¥½ã€å†å²è®°å½•**

**åº”è¯¥å­˜å‚¨çš„å†…å®¹**ï¼š
- âœ… ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ï¼ˆå§“åã€é‚®ç®±ã€åå¥½ç­‰ï¼‰
- âœ… ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯å’Œåå¥½è®¾ç½®
- âœ… ç”¨æˆ·çš„å†å²äº¤äº’è®°å½•ï¼ˆè·¨ Agentï¼‰
- âœ… ç”¨æˆ·çš„è®¢é˜…å’Œæƒé™ä¿¡æ¯
- âœ… ç”¨æˆ·çš„åé¦ˆå’Œè¯„ä»·

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
- åˆ›å»ºï¼šç”¨æˆ·æ³¨å†Œæ—¶
- æ›´æ–°ï¼šç”¨æˆ·ä¿¡æ¯å˜åŒ–æ—¶
- åˆ é™¤ï¼šç”¨æˆ·æ³¨é”€æ—¶ï¼ˆç¬¦åˆ GDPRï¼‰

**éš”ç¦»æ€§**ï¼š
- ğŸ”’ æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„ç©ºé—´
- ğŸ”’ ä¸åŒç”¨æˆ·ä¹‹é—´å®Œå…¨éš”ç¦»
- âœ… åŒä¸€ç”¨æˆ·å¯ä»¥è¢«å¤šä¸ª Agent è®¿é—®ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰

**ç¤ºä¾‹**ï¼š
```
cortex://users/user-12345/
â”œâ”€â”€ profile/
â”‚   â”œâ”€â”€ basic_info.json           # åŸºæœ¬ä¿¡æ¯
â”‚   â”œâ”€â”€ preferences.json          # åå¥½è®¾ç½®
â”‚   â””â”€â”€ settings.json             # ç³»ç»Ÿè®¾ç½®
â”œâ”€â”€ history/
â”‚   â”œâ”€â”€ 2026-02/
â”‚   â”‚   â”œâ”€â”€ conversations.md      # å¯¹è¯å†å²
â”‚   â”‚   â””â”€â”€ actions.log           # æ“ä½œæ—¥å¿—
â”‚   â””â”€â”€ analytics.json            # ä½¿ç”¨åˆ†æ
â””â”€â”€ subscriptions/
    â””â”€â”€ plans.json                # è®¢é˜…è®¡åˆ’
```

---

### 3. `cortex://threads/{thread_id}/` - Thread ç»´åº¦

**è®¾è®¡æ„å›¾**ï¼šå­˜å‚¨ **ç‰¹å®šå¯¹è¯çº¿ç¨‹çš„æ¶ˆæ¯å’Œä¸Šä¸‹æ–‡**

**åº”è¯¥å­˜å‚¨çš„å†…å®¹**ï¼š
- âœ… å¯¹è¯æ¶ˆæ¯çš„æ—¶é—´çº¿ï¼ˆTimelineï¼‰
- âœ… å¯¹è¯çš„ä¸Šä¸‹æ–‡å’ŒçŠ¶æ€
- âœ… å¯¹è¯çš„å…ƒæ•°æ®ï¼ˆå‚ä¸è€…ã€æ ‡ç­¾ã€æ—¶é—´ï¼‰
- âœ… å¯¹è¯çš„é™„ä»¶å’Œå¼•ç”¨
- âœ… å¯¹è¯çš„æ‘˜è¦å’Œæ¦‚è§ˆï¼ˆL0/L1 å±‚ï¼‰

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
- åˆ›å»ºï¼šå¯¹è¯å¼€å§‹æ—¶
- æ›´æ–°ï¼šæ¯æ¬¡æ¶ˆæ¯å‘é€æ—¶
- åˆ é™¤ï¼šå¯¹è¯ç»“æŸæˆ–è¿‡æœŸæ—¶

**éš”ç¦»æ€§**ï¼š
- ğŸ”’ æ¯ä¸ªå¯¹è¯çº¿ç¨‹ç‹¬ç«‹
- ğŸ”’ ä¸åŒçº¿ç¨‹ä¹‹é—´éš”ç¦»
- âœ… åŒä¸€çº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªå‚ä¸è€…ï¼ˆuser + agentï¼‰

**ç¤ºä¾‹**ï¼š
```
cortex://threads/thread-abc123/
â”œâ”€â”€ .session.json                 # ä¼šè¯å…ƒæ•°æ®
â””â”€â”€ timeline/
    â””â”€â”€ 2026-02/
        â””â”€â”€ 09/
            â”œâ”€â”€ 14_30_45_msg1.md  # L2 - å®Œæ•´æ¶ˆæ¯
            â”œâ”€â”€ .abstract.md       # L0 - æ‘˜è¦
            â””â”€â”€ .overview.md       # L1 - æ¦‚è§ˆ
```

---

### 4. `cortex://global/` - Global ç»´åº¦

**è®¾è®¡æ„å›¾**ï¼šå­˜å‚¨ **å…¨å±€å…±äº«çš„å…¬å…±çŸ¥è¯†å’Œèµ„æº**

**åº”è¯¥å­˜å‚¨çš„å†…å®¹**ï¼š
- âœ… å…¬å…±çŸ¥è¯†åº“ï¼ˆç»´åŸºã€æ–‡æ¡£ï¼‰
- âœ… å…±äº«çš„æœ€ä½³å®è·µ
- âœ… ç³»ç»Ÿçº§é…ç½®å’Œæ¨¡æ¿
- âœ… å…¬å¼€çš„æ•°æ®é›†å’Œèµ„æº
- âœ… ç¤¾åŒºè´¡çŒ®çš„å†…å®¹

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
- åˆ›å»ºï¼šç³»ç»Ÿåˆå§‹åŒ–æˆ–ç®¡ç†å‘˜æ·»åŠ 
- æ›´æ–°ï¼šå†…å®¹æ›´æ–°æ—¶
- åˆ é™¤ï¼šå†…å®¹è¿‡æ—¶æˆ–ç§»é™¤æ—¶

**éš”ç¦»æ€§**ï¼š
- ğŸŒ æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®ï¼ˆåªè¯»æˆ–è¯»å†™ï¼Œå–å†³äºæƒé™ï¼‰
- ğŸŒ ä¸éš”ç¦»ï¼Œå…¨å±€å…±äº«

**ç¤ºä¾‹**ï¼š
```
cortex://global/
â”œâ”€â”€ knowledge/
â”‚   â”œâ”€â”€ rust_documentation/       # Rust æ–‡æ¡£
â”‚   â”œâ”€â”€ design_patterns/          # è®¾è®¡æ¨¡å¼
â”‚   â””â”€â”€ algorithms/               # ç®—æ³•çŸ¥è¯†
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ prompts/                  # æç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ workflows/                # å·¥ä½œæµæ¨¡æ¿
â””â”€â”€ resources/
    â”œâ”€â”€ datasets/                 # å…¬å¼€æ•°æ®é›†
    â””â”€â”€ models/                   # æ¨¡å‹é…ç½®
```

---

## ğŸ¯ æ­£ç¡®çš„é€‰æ‹©ä¾æ®

### å†³ç­–æ ‘

```
è¦å­˜å‚¨çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ
â”œâ”€ æ˜¯ Agent è‡ªèº«çš„çŸ¥è¯†/é…ç½®ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ cortex://agents/{agent_id}/
â”‚
â”œâ”€ æ˜¯ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯/åå¥½ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ cortex://users/{user_id}/
â”‚
â”œâ”€ æ˜¯ç‰¹å®šå¯¹è¯çš„æ¶ˆæ¯/ä¸Šä¸‹æ–‡ï¼Ÿ
â”‚  â””â”€ ä½¿ç”¨ cortex://threads/{thread_id}/
â”‚
â””â”€ æ˜¯å…¨å±€å…±äº«çš„å…¬å…±çŸ¥è¯†ï¼Ÿ
   â””â”€ ä½¿ç”¨ cortex://global/
```

### åˆ¤æ–­æ ‡å‡†

| é—®é¢˜ | agents | users | threads | global |
|------|--------|-------|---------|--------|
| **è°æ‹¥æœ‰ï¼Ÿ** | Agent | User | Conversation | Everyone |
| **è°è®¿é—®ï¼Ÿ** | è¯¥ Agent | è¯¥ User | å‚ä¸è€… | æ‰€æœ‰äºº |
| **ç”Ÿå‘½å‘¨æœŸ** | Agent ç”Ÿå‘½å‘¨æœŸ | User ç”Ÿå‘½å‘¨æœŸ | å¯¹è¯ç”Ÿå‘½å‘¨æœŸ | æ°¸ä¹… |
| **æ˜¯å¦å…±äº«ï¼Ÿ** | âŒ ä¸å…±äº« | âŒ ä¸å…±äº« | âœ… å‚ä¸è€…å…±äº« | âœ… å…¨å±€å…±äº« |
| **æ˜¯å¦éš”ç¦»ï¼Ÿ** | âœ… å®Œå…¨éš”ç¦» | âœ… å®Œå…¨éš”ç¦» | âœ… çº¿ç¨‹éš”ç¦» | âŒ ä¸éš”ç¦» |

---

## ğŸš¨ å½“å‰ TARS çš„é—®é¢˜

### é—®é¢˜æè¿°

TARS å½“å‰ä½¿ç”¨ `cortex://threads/{agent_id}` æ¥éš”ç¦»ä¸åŒ Agent çš„è®°å¿†ï¼š

```rust
// å½“å‰çš„åšæ³•ï¼ˆä¸æ­£ç¡®ï¼‰
let thread_id = agent_id;  // å°† agent_id å½“ä½œ thread_id
let uri = format!("cortex://threads/{}/timeline/...", thread_id);
```

**ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ**
- åº•å±‚ `SessionManager` å’Œ `MessageStorage` ç¡¬ç¼–ç ä½¿ç”¨ `cortex://threads/`
- ä¸ºäº†å®ç° Agent éš”ç¦»ï¼Œå°† `agent_id` æ˜ å°„ä¸º `thread_id`
- è¿™æ˜¯ä¸€ç§**æŠ€æœ¯å¦¥å**ï¼Œä¸æ˜¯æ­£ç¡®çš„è®¾è®¡

### é—®é¢˜åˆ†æ

| æ–¹é¢ | å½“å‰åšæ³• | é—®é¢˜ |
|------|---------|------|
| **è¯­ä¹‰** | threads æ˜¯å¯¹è¯çº¿ç¨‹ | âŒ ç”¨ agent_id ä½œä¸º thread_idï¼Œè¯­ä¹‰æ··æ·† |
| **å¯æ‰©å±•æ€§** | æ¯ä¸ª agent åªæœ‰ä¸€ä¸ª "thread" | âŒ æ— æ³•æ”¯æŒä¸€ä¸ª agent æœ‰å¤šä¸ªå¯¹è¯ |
| **æ•°æ®ç»“æ„** | timeline å­˜å‚¨æ‰€æœ‰æ¶ˆæ¯ | âŒ æ··æ·†äº† agent è®°å¿†å’Œå¯¹è¯è®°å¿† |
| **æ£€ç´¢** | éœ€è¦çŸ¥é“ agent_id | âš ï¸ æ— æ³•æŒ‰çœŸæ­£çš„ thread_id æ£€ç´¢ |

---

## âœ… æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼

### æ–¹æ¡ˆ1ï¼šåˆ†ç¦» Agent è®°å¿†å’Œå¯¹è¯è®°å¿†ï¼ˆæ¨èï¼‰

```
cortex://agents/{agent_id}/
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ long_term/                # Agent çš„é•¿æœŸè®°å¿†
â”‚   â”‚   â”œâ”€â”€ knowledge.md
â”‚   â”‚   â””â”€â”€ experiences.md
â”‚   â””â”€â”€ working/                  # Agent çš„å·¥ä½œè®°å¿†
â”‚       â””â”€â”€ current_context.md
â””â”€â”€ config/
    â””â”€â”€ system_prompt.md

cortex://threads/{thread_id}/
â”œâ”€â”€ .session.json                 # ä¼šè¯å…ƒæ•°æ®
â”‚   â”œâ”€â”€ participants: [agent_id, user_id]  # å‚ä¸è€…
â”‚   â””â”€â”€ ...
â””â”€â”€ timeline/
    â””â”€â”€ 2026-02/09/
        â”œâ”€â”€ 14_30_45_msg1.md      # å¯¹è¯æ¶ˆæ¯
        â”œâ”€â”€ .abstract.md
        â””â”€â”€ .overview.md
```

**ä½¿ç”¨åœºæ™¯**ï¼š
```rust
// 1. Agent å­¦ä¹ æ–°çŸ¥è¯† â†’ å­˜åˆ° agents
let knowledge_uri = format!("cortex://agents/{}/memory/long_term/rust_tips.md", agent_id);
filesystem.write(&knowledge_uri, &new_knowledge).await?;

// 2. å¯¹è¯æ¶ˆæ¯ â†’ å­˜åˆ° threads
let thread_id = Uuid::new_v4().to_string();  // çœŸæ­£çš„ thread_id
let msg_uri = format!("cortex://threads/{}/timeline/...", thread_id);
message_storage.save_message(&thread_id, &message).await?;

// 3. åœ¨ session ä¸­è®°å½•å‚ä¸è€…
session.participants = vec![agent_id.clone(), user_id.clone()];

// 4. æ£€ç´¢æ—¶å¯ä»¥è·¨ç»´åº¦
// - ä» agents åŠ è½½ agent çš„çŸ¥è¯†
// - ä» threads åŠ è½½å¯¹è¯å†å²
// - ç»“åˆä¸¤è€…æä¾›å®Œæ•´çš„ä¸Šä¸‹æ–‡
```

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨ agents ä½œä¸ºä¸»ç©ºé—´ï¼ˆç®€åŒ–ç‰ˆï¼‰

å¦‚æœä½ çš„åº”ç”¨ä¸­ï¼Œæ¯ä¸ª agent å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è¯å®ä½“ï¼ˆåƒ TARSï¼‰ï¼Œå¯ä»¥ï¼š

```
cortex://agents/{agent_id}/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ system_prompt.md
â”œâ”€â”€ memory/
â”‚   â””â”€â”€ knowledge/
â””â”€â”€ conversations/                # å¯¹è¯è®°å½•
    â””â”€â”€ thread-{timestamp}/
        â””â”€â”€ timeline/
            â””â”€â”€ 2026-02/09/
                â”œâ”€â”€ 14_30_45_msg1.md
                â””â”€â”€ .overview.md
```

**ä½¿ç”¨åœºæ™¯**ï¼š
```rust
// æ‰€æœ‰å†…å®¹éƒ½å­˜åˆ° agents ä¸‹
let base_uri = format!("cortex://agents/{}", agent_id);

// å¯¹è¯æ¶ˆæ¯å­˜åˆ° agents çš„ conversations å­ç›®å½•
let thread_id = Uuid::new_v4().to_string();
let msg_uri = format!("{}/conversations/{}/timeline/...", base_uri, thread_id);
```

**ä¼˜ç‚¹**ï¼š
- âœ… è¯­ä¹‰æ¸…æ™°ï¼šæ‰€æœ‰å†…å®¹éƒ½å±äºè¯¥ agent
- âœ… éš”ç¦»æœ‰æ•ˆï¼šä¸åŒ agent å®Œå…¨éš”ç¦»
- âœ… ç®¡ç†æ–¹ä¾¿ï¼šä¸€ä¸ª agent çš„æ‰€æœ‰æ•°æ®åœ¨ä¸€ä¸ªåœ°æ–¹

**ç¼ºç‚¹**ï¼š
- âš ï¸ æ— æ³•å®ç°è·¨ agent çš„å¯¹è¯ï¼ˆå¤šä¸ª agent å‚ä¸åŒä¸€ä¸ª threadï¼‰
- âš ï¸ æ— æ³•å®ç°ç”¨æˆ·è§†è§’çš„å¯¹è¯å†å²ï¼ˆè·¨ agentï¼‰

---

## ğŸ“Š å®é™…åº”ç”¨åœºæ™¯å¯¹æ¯”

### åœºæ™¯1ï¼šå¤š Agent åä½œå¹³å°

**éœ€æ±‚**ï¼š
- å¤šä¸ª Agent å¯èƒ½å‚ä¸åŒä¸€ä¸ªå¯¹è¯
- ç”¨æˆ·å¯èƒ½åŒæ—¶ä¸å¤šä¸ª Agent äº¤äº’
- éœ€è¦è·¨ Agent çš„å¯¹è¯å†å²

**æ¨èæ–¹æ¡ˆ**ï¼š**æ–¹æ¡ˆ1 - åˆ†ç¦» Agent è®°å¿†å’Œå¯¹è¯è®°å¿†**

```
cortex://agents/{agent_1}/memory/...     # Agent 1 çš„çŸ¥è¯†
cortex://agents/{agent_2}/memory/...     # Agent 2 çš„çŸ¥è¯†
cortex://threads/{thread_1}/             # å¯¹è¯ 1ï¼ˆå¯èƒ½åŒ…å« agent_1 å’Œ agent_2ï¼‰
cortex://threads/{thread_2}/             # å¯¹è¯ 2ï¼ˆå¯èƒ½åŒ…å« agent_1 å’Œ userï¼‰
cortex://users/{user_1}/history/...      # ç”¨æˆ· 1 çš„å†å²ï¼ˆè·¨ Agentï¼‰
```

### åœºæ™¯2ï¼šå• Agent ä¸ªäººåŠ©æ‰‹ï¼ˆå¦‚ TARSï¼‰

**éœ€æ±‚**ï¼š
- æ¯ä¸ª Agent æ˜¯ç‹¬ç«‹çš„ä¸ªäººåŠ©æ‰‹
- ä¸€ä¸ª Agent åªæœåŠ¡ä¸€ä¸ªç”¨æˆ·
- ä¸éœ€è¦è·¨ Agent çš„åä½œ

**æ¨èæ–¹æ¡ˆ**ï¼š**æ–¹æ¡ˆ2 - ä½¿ç”¨ agents ä½œä¸ºä¸»ç©ºé—´**

```
cortex://agents/{agent_id}/
â”œâ”€â”€ memory/knowledge/                    # Agent çš„çŸ¥è¯†
â””â”€â”€ conversations/                       # æ‰€æœ‰å¯¹è¯
    â”œâ”€â”€ thread-2026-02-09-001/
    â””â”€â”€ thread-2026-02-09-002/
```

### åœºæ™¯3ï¼šå®¢æœç³»ç»Ÿ

**éœ€æ±‚**ï¼š
- å¤šä¸ªå®¢æœ Agent
- ç”¨æˆ·å¯èƒ½ä¸ä¸åŒ Agent å¯¹è¯
- éœ€è¦è¿½è¸ªç”¨æˆ·çš„å®Œæ•´å†å²

**æ¨èæ–¹æ¡ˆ**ï¼š**æ–¹æ¡ˆ1 + ç”¨æˆ·ç»´åº¦**

```
cortex://agents/{agent_cs_1}/            # å®¢æœ Agent 1
cortex://agents/{agent_cs_2}/            # å®¢æœ Agent 2
cortex://threads/{thread_1}/             # å®¢æœå¯¹è¯ 1
cortex://users/{user_1}/                 # ç”¨æˆ· 1 çš„å†å²
    â””â”€â”€ support_tickets/                 # æ‰€æœ‰å·¥å•
        â”œâ”€â”€ ticket-001.md
        â””â”€â”€ ticket-002.md
```

---

## ğŸ”§ é‡æ„å»ºè®®

### çŸ­æœŸï¼ˆä¿®å¤ TARSï¼‰

ä¿æŒå½“å‰çš„ `cortex://threads/{agent_id}` æ–¹æ¡ˆï¼Œä½†ï¼š

1. **åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜**ï¼š
   ```
   æ³¨æ„ï¼šå½“å‰ TARS ä½¿ç”¨ threads/{agent_id} ä½œä¸º agent çš„ä¸“å±ç©ºé—´ã€‚
   è¿™æ˜¯ä¸€ç§æŠ€æœ¯å¦¥åï¼Œæœªæ¥å°†è¿ç§»åˆ° agents/{agent_id}ã€‚
   ```

2. **åœ¨ä»£ç ä¸­æ·»åŠ æ³¨é‡Š**ï¼š
   ```rust
   // FIXME: Should use cortex://agents/{agent_id} instead of threads/{agent_id}
   // Current implementation uses threads for backward compatibility
   let uri = format!("cortex://threads/{}/...", agent_id);
   ```

3. **æä¾›è¿ç§»è®¡åˆ’**ï¼š
   - è®¾è®¡æ•°æ®è¿ç§»å·¥å…·
   - æä¾›è¿ç§»è„šæœ¬

### ä¸­æœŸï¼ˆé‡æ„åº•å±‚ï¼‰

é‡æ„ `SessionManager` å’Œ `MessageStorage`ï¼Œæ”¯æŒè‡ªå®šä¹‰ dimensionï¼š

```rust
// æ–°çš„ API
impl MessageStorage {
    pub async fn save_message(
        &self, 
        dimension: &str,      // "agents", "threads", "users", "global"
        id: &str,             // agent_id, thread_id, user_id, etc.
        message: &Message
    ) -> Result<String> {
        let uri = format!("cortex://{}/{}/timeline/...", dimension, id);
        // ...
    }
}

// TARS ä½¿ç”¨
message_storage.save_message("agents", agent_id, &message).await?;

// å®¢æœç³»ç»Ÿä½¿ç”¨
message_storage.save_message("threads", thread_id, &message).await?;
```

### é•¿æœŸï¼ˆå®Œæ•´çš„å¤šç»´åº¦æ”¯æŒï¼‰

å®ç°å®Œæ•´çš„å››ç»´ç©ºé—´æ¶æ„ï¼š

```rust
pub struct CortexMemory {
    agents: AgentDimension,
    users: UserDimension,
    threads: ThreadDimension,
    global: GlobalDimension,
}

impl CortexMemory {
    // è·¨ç»´åº¦æ£€ç´¢
    pub async fn search(&self, query: &str, scopes: Vec<&str>) -> Result<Vec<SearchResult>> {
        let mut results = Vec::new();
        
        for scope in scopes {
            match scope {
                "agents" => results.extend(self.agents.search(query).await?),
                "threads" => results.extend(self.threads.search(query).await?),
                "users" => results.extend(self.users.search(query).await?),
                "global" => results.extend(self.global.search(query).await?),
                _ => {}
            }
        }
        
        Ok(results)
    }
}
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **agents**: Agent çš„çŸ¥è¯†å’Œé…ç½®
2. **users**: ç”¨æˆ·çš„ä¿¡æ¯å’Œåå¥½
3. **threads**: å¯¹è¯çš„æ¶ˆæ¯å’Œä¸Šä¸‹æ–‡
4. **global**: å…¨å±€å…±äº«çš„å…¬å…±çŸ¥è¯†

### é€‰æ‹©ä¾æ®

| ä½ è¦å­˜å‚¨çš„æ˜¯... | ä½¿ç”¨... |
|---------------|---------|
| Agent å­¦åˆ°çš„æ–°çŸ¥è¯† | `cortex://agents/{agent_id}/memory/` |
| Agent çš„ç³»ç»Ÿæç¤ºè¯ | `cortex://agents/{agent_id}/config/` |
| ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ | `cortex://users/{user_id}/profile/` |
| ç”¨æˆ·çš„åå¥½è®¾ç½® | `cortex://users/{user_id}/preferences/` |
| å¯¹è¯çš„æ¶ˆæ¯è®°å½• | `cortex://threads/{thread_id}/timeline/` |
| å¯¹è¯çš„æ‘˜è¦ | `cortex://threads/{thread_id}/.overview.md` |
| å…¬å…±çš„çŸ¥è¯†åº“ | `cortex://global/knowledge/` |
| ç³»ç»Ÿçº§çš„æ¨¡æ¿ | `cortex://global/templates/` |

### TARS çš„å½“å‰çŠ¶æ€

- âœ… **åŠŸèƒ½æ­£ç¡®**ï¼šAgent è®°å¿†éš”ç¦»ç”Ÿæ•ˆ
- âš ï¸ **è¯­ä¹‰æ··æ·†**ï¼šä½¿ç”¨ threads è€Œé agents
- ğŸ”§ **éœ€è¦é‡æ„**ï¼šæœªæ¥è¿ç§»åˆ° agents ç»´åº¦

### æ¨èæ–¹æ¡ˆ

- **TARSï¼ˆå• Agent åŠ©æ‰‹ï¼‰**ï¼šä½¿ç”¨ **æ–¹æ¡ˆ2ï¼ˆagents ä½œä¸ºä¸»ç©ºé—´ï¼‰**
- **å¤š Agent å¹³å°**ï¼šä½¿ç”¨ **æ–¹æ¡ˆ1ï¼ˆåˆ†ç¦» Agent å’Œ Threadï¼‰**
- **å®¢æœç³»ç»Ÿ**ï¼šä½¿ç”¨ **æ–¹æ¡ˆ1 + ç”¨æˆ·ç»´åº¦**

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-02-09 15:35  
**ä½œè€…**: AI Assistant  
**ç‰ˆæœ¬**: 1.0

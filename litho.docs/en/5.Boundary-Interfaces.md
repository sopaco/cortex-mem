# System Boundary Interface Documentation

This document describes the system's external invocation interfaces, including CLI commands, API endpoints, configuration parameters, and other boundary mechanisms.

## Command Line Interface (CLI)

### cortex-mem-cli

**Description**: Command-line interface for interacting with the Cortex-Mem system, supporting operations like search, add, list, and configuration loading.

**Source File**: `cortex-mem-cli/src/main.rs`

**Arguments**:

- `config` (string): required - Path to the configuration file (TOML format)
- `scope` (string): optional - Scope of the search operation (e.g., user, system)
- `limit` (integer): optional - Maximum number of results to return (default: `10`)

**Usage Examples**:

```bash
cortex-mem-cli --config config.toml search "user preferences" --scope user --limit 5
```

## API Interfaces

### GET /health

**Description**: Returns system health status including service version, LLM availability, and timestamp.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: {"status": "string", "service": "string", "version": "string", "llm_available": "boolean", "timestamp": "string"}

### GET /filesystem/list

**Description**: Lists directory contents under the specified URI, filtering hidden files except .abstract.md and .overview.md.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: array of file/directory names

### GET /filesystem/read/*path

**Description**: Reads the content of a file at the specified path, stripping the 'cortex://' prefix if present.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: string (file content)

### POST /filesystem/write

**Description**: Writes content to a file at the specified path; automatically creates parent directories if needed.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Request Format**: {"path": "string", "content": "string"}

**Response Format**: {"success": "boolean", "message": "string"}

### GET /filesystem/stats

**Description**: Returns recursive statistics for a directory: file count and total size.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: {"file_count": "integer", "total_size": "integer"}

### GET /sessions

**Description**: Lists all active sessions with metadata.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Response Format**: array of session objects

### POST /sessions

**Description**: Creates a new session with optional thread_id and title.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {"thread_id": "string", "title": "string"}

**Response Format**: {"session_id": "string", "thread_id": "string", "created_at": "string"}

### POST /sessions/:thread_id/messages

**Description**: Adds a message to a session thread with role and content.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {"role": "string", "content": "string"}

**Response Format**: {"message_id": "string", "timestamp": "string"}

### POST /sessions/:thread_id/close

**Description**: Closes a session thread, marking it as inactive.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {}

**Response Format**: {"status": "closed", "thread_id": "string"}

### POST /search

**Description**: Performs semantic search using layered L0/L1/L2 retrieval; supports query, thread context, limit, and min_score.

**Source File**: `cortex-mem-service/src/handlers/search.rs`

**Request Format**: {"query": "string", "thread": "string", "limit": "integer", "min_score": "float"}

**Response Format**: {"results": [{"id": "string", "content": "string", "score": "float", "snippet": "string"}]}

### POST /automation/extract/:thread_id

**Description**: Triggers LLM-based memory extraction from a session thread; supports auto_save flag.

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Request Format**: {"auto_save": "boolean"}

**Response Format**: {"extracted_facts": "integer", "extracted_entities": "integer", "extracted_decisions": "integer", "saved": "boolean"}

### POST /automation/index/:thread_id

**Description**: Deprecated: Indexes a specific thread (use extraction instead).

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### POST /automation/index-all

**Description**: Deprecated: Indexes all threads (use extraction instead).

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### GET /tenants

**Description**: Lists all available tenants.

**Source File**: `cortex-mem-service/src/handlers/tenants.rs`

**Response Format**: array of tenant IDs

### POST /tenants/switch

**Description**: Switches the active tenant context.

**Source File**: `cortex-mem-service/src/handlers/tenants.rs`

**Request Format**: {"tenant_id": "string"}

**Response Format**: {"current_tenant": "string", "success": "boolean"}

### GET /api/v2/health

**Description**: Health endpoint under v2 API namespace (same as /health).

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: {"status": "string", "service": "string", "version": "string", "llm_available": "boolean", "timestamp": "string"}

### GET /api/v2/filesystem/list

**Description**: List directory contents under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: array of file/directory names

### GET /api/v2/filesystem/read/*path

**Description**: Read file content under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: string (file content)

### POST /api/v2/filesystem/write

**Description**: Write file under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"path": "string", "content": "string"}

**Response Format**: {"success": "boolean", "message": "string"}

### GET /api/v2/filesystem/stats

**Description**: Get directory stats under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: {"file_count": "integer", "total_size": "integer"}

### GET /api/v2/sessions

**Description**: List sessions under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: array of session objects

### POST /api/v2/sessions

**Description**: Create session under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"thread_id": "string", "title": "string"}

**Response Format**: {"session_id": "string", "thread_id": "string", "created_at": "string"}

### POST /api/v2/sessions/:thread_id/messages

**Description**: Add message to session under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"role": "string", "content": "string"}

**Response Format**: {"message_id": "string", "timestamp": "string"}

### POST /api/v2/sessions/:thread_id/close

**Description**: Close session under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {}

**Response Format**: {"status": "closed", "thread_id": "string"}

### POST /api/v2/search

**Description**: Semantic search under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"query": "string", "thread": "string", "limit": "integer", "min_score": "float"}

**Response Format**: {"results": [{"id": "string", "content": "string", "score": "float", "snippet": "string"}]}

### POST /api/v2/automation/extract/:thread_id

**Description**: Trigger memory extraction under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"auto_save": "boolean"}

**Response Format**: {"extracted_facts": "integer", "extracted_entities": "integer", "extracted_decisions": "integer", "saved": "boolean"}

### POST /api/v2/automation/index/:thread_id

**Description**: Deprecated: Index thread under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### POST /api/v2/automation/index-all

**Description**: Deprecated: Index all threads under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### GET /api/v2/tenants

**Description**: List tenants under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: array of tenant IDs

### POST /api/v2/tenants/switch

**Description**: Switch tenant under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"tenant_id": "string"}

**Response Format**: {"current_tenant": "string", "success": "boolean"}

## Router Routes

### /filesystem/list

**Description**: Lists directory contents under the tenant's data root.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

### /filesystem/read/*path

**Description**: Reads a file at the specified path; wildcard captures full path relative to data root.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

**Parameters**:

- `path` (string): Relative file path within the cortex data directory
### /filesystem/write

**Description**: Writes content to a file; parent directories are auto-created.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

### /filesystem/stats

**Description**: Returns recursive statistics for a directory.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

### /sessions

**Description**: Manages session lifecycle: list or create sessions.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

### /sessions/:thread_id/messages

**Description**: Adds a message to a specific session thread.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /sessions/:thread_id/close

**Description**: Closes a session thread.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /search

**Description**: Performs semantic search using layered vector retrieval.

**Source File**: `cortex-mem-service/src/routes/search.rs`

### /automation/extract/:thread_id

**Description**: Triggers memory extraction from a session thread.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /automation/index/:thread_id

**Description**: Deprecated: Indexes a specific thread.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /automation/index-all

**Description**: Deprecated: Indexes all threads.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

### /tenants

**Description**: Lists all available tenants.

**Source File**: `cortex-mem-service/src/routes/tenants.rs`

### /tenants/switch

**Description**: Switches the active tenant context.

**Source File**: `cortex-mem-service/src/routes/tenants.rs`

### /api/v2/*

**Description**: All v2 API routes are nested under this prefix; sub-routes inherit parent path.

**Source File**: `cortex-mem-service/src/main.rs`

**Parameters**:

- `*path` (string): Wildcard matching all sub-path segments under /api/v2
## Integration Suggestions

### HTTP API

Integrate with the HTTP API using authenticated requests and proper error handling.

**Example Code**:

```
import requests

headers = {"Authorization": "Bearer YOUR_API_KEY"}
response = requests.post(
    "http://localhost:8085/api/v2/search",
    json={"query": "user preferences", "thread": "session_123", "limit": 5},
    headers=headers
)
print(response.json())
```

**Best Practices**:

- Always use HTTPS in production
- Include API key in Authorization header
- Validate response status codes
- Implement retry logic for transient failures
- Use connection pooling for high throughput

### CLI

Use the CLI for local development and scripting tasks.

**Example Code**:

```
#!/bin/bash
cortex-mem-cli --config ./config.toml search "recent meeting notes" --scope user --limit 3
```

**Best Practices**:

- Store config files with restricted permissions (600)
- Use environment variables for sensitive values
- Wrap CLI calls in shell scripts for reusability
- Log output for audit trails
- Validate inputs before execution

### MCP (stdio)

Connect via stdio to the MCP server for agent-based communication.

**Example Code**:

```
#!/bin/bash
cortex-mem-mcp --config config.toml
# Then send JSON over stdin:
echo '{"method": "search", "params": {"query": "urgent task"}}' | cortex-mem-mcp --config config.toml
```

**Best Practices**:

- Use structured JSON for all messages
- Implement message framing (e.g., newline-delimited)
- Handle stdio buffering and timeouts
- Validate schema of incoming/outgoing messages
- Use logging for debugging IPC flows

### Web UI (Svelte)

Integrate with the Svelte frontend using the API endpoints.

**Example Code**:

```
import { writable } from 'svelte/store';

export const searchResults = writable([]);

export async function search(query) {
  const res = await fetch('/api/v2/search', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ query, thread: 'current_session' })
  });
  searchResults.set(await res.json());
}
```

---

**Analysis Confidence**: 9.5/10

# System Boundary Interface Documentation

This document describes the system's external invocation interfaces, including CLI commands, API endpoints, configuration parameters, and other boundary mechanisms.

## Command Line Interface (CLI)

### cortex-mem-cli

**Description**: Command-line interface for interacting with the Cortex-Mem system, supporting operations like search, add, list, get, delete, session management, layer management, and tenant management.

**Source File**: `cortex-mem-cli/src/main.rs`

**Global Options**:

| Option | Short | Default | Description |
|--------|-------|---------|-------------|
| `--config` | `-c` | `config.toml` | Path to configuration file |
| `--tenant` | | `default` | Tenant identifier (use `tenant list` to see available tenants) |
| `--verbose` | `-v` | `false` | Enable verbose/debug logging |

**Available Commands**:

| Command | Description |
|---------|-------------|
| `session` | Session management (create, list) |
| `add` | Add a message to a session |
| `search` | Search memories using semantic vector search |
| `list` | List memories in a directory |
| `get` | Get a specific memory by URI |
| `delete` | Delete a memory by URI |
| `layers` | Layer management (L0/L1 files) |
| `stats` | Show system statistics |
| `tenant` | Tenant management (list available tenants) |

**Usage Examples**:

```bash
# List available tenants
cortex-mem -c config.toml tenant list

# Create a session
cortex-mem -c config.toml session create my-session --title "My Session"

# Add a message
cortex-mem -c config.toml add --thread my-session "Hello, this is a test message"

# Search for memories
cortex-mem -c config.toml search "user preferences" --scope user --limit 5

# List memories
cortex-mem -c config.toml list --uri cortex://user

# Get a specific memory
cortex-mem -c config.toml get cortex://session/my-session/timeline/2024/01/15/14_30_00_abc123.md

# Show statistics
cortex-mem -c config.toml stats

# Generate missing L0/L1 layer files
cortex-mem -c config.toml layers ensure-all
```

## API Interfaces

### GET /health

**Description**: Returns system health status including service version, LLM availability, and timestamp.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: {"status": "string", "service": "string", "version": "string", "llm_available": "boolean", "timestamp": "string"}

### GET /filesystem/list

**Description**: Lists directory contents under the specified URI, filtering hidden files except .abstract.md and .overview.md.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: array of file/directory names

### GET /filesystem/read/*path

**Description**: Reads the content of a file at the specified path, stripping the 'cortex://' prefix if present.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: string (file content)

### POST /filesystem/write

**Description**: Writes content to a file at the specified path; automatically creates parent directories if needed.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Request Format**: {"path": "string", "content": "string"}

**Response Format**: {"success": "boolean", "message": "string"}

### GET /filesystem/stats

**Description**: Returns recursive statistics for a directory: file count and total size.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: {"file_count": "integer", "total_size": "integer"}

### GET /sessions

**Description**: Lists all active sessions with metadata.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Response Format**: array of session objects

### POST /sessions

**Description**: Creates a new session with optional thread_id and title.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {"thread_id": "string", "title": "string"}

**Response Format**: {"session_id": "string", "thread_id": "string", "created_at": "string"}

### POST /sessions/:thread_id/messages

**Description**: Adds a message to a session thread with role and content.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {"role": "string", "content": "string"}

**Response Format**: {"message_id": "string", "timestamp": "string"}

### POST /sessions/:thread_id/close

**Description**: Closes a session thread, marking it as inactive.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {}

**Response Format**: {"status": "closed", "thread_id": "string"}

### POST /search

**Description**: Performs semantic search using layered L0/L1/L2 retrieval; supports query, thread context, limit, and min_score.

**Source File**: `cortex-mem-service/src/handlers/search.rs`

**Request Format**: {"query": "string", "thread": "string", "limit": "integer", "min_score": "float"}

**Response Format**: {"results": [{"id": "string", "content": "string", "score": "float", "snippet": "string"}]}

### POST /automation/extract/:thread_id

**Description**: Triggers LLM-based memory extraction from a session thread; supports auto_save flag.

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Request Format**: {"auto_save": "boolean"}

**Response Format**: {"extracted_facts": "integer", "extracted_entities": "integer", "extracted_decisions": "integer", "saved": "boolean"}

### POST /automation/index/:thread_id

**Description**: Deprecated: Indexes a specific thread (use extraction instead).

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### POST /automation/index-all

**Description**: Deprecated: Indexes all threads (use extraction instead).

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### GET /tenants

**Description**: Lists all available tenants.

**Source File**: `cortex-mem-service/src/handlers/tenants.rs`

**Response Format**: array of tenant IDs

### POST /tenants/switch

**Description**: Switches the active tenant context.

**Source File**: `cortex-mem-service/src/handlers/tenants.rs`

**Request Format**: {"tenant_id": "string"}

**Response Format**: {"current_tenant": "string", "success": "boolean"}

### GET /api/v2/health

**Description**: Health endpoint under v2 API namespace (same as /health).

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: {"status": "string", "service": "string", "version": "string", "llm_available": "boolean", "timestamp": "string"}

### GET /api/v2/filesystem/list

**Description**: List directory contents under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: array of file/directory names

### GET /api/v2/filesystem/read/*path

**Description**: Read file content under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: string (file content)

### POST /api/v2/filesystem/write

**Description**: Write file under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"path": "string", "content": "string"}

**Response Format**: {"success": "boolean", "message": "string"}

### GET /api/v2/filesystem/stats

**Description**: Get directory stats under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: {"file_count": "integer", "total_size": "integer"}

### GET /api/v2/sessions

**Description**: List sessions under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: array of session objects

### POST /api/v2/sessions

**Description**: Create session under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"thread_id": "string", "title": "string"}

**Response Format**: {"session_id": "string", "thread_id": "string", "created_at": "string"}

### POST /api/v2/sessions/:thread_id/messages

**Description**: Add message to session under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"role": "string", "content": "string"}

**Response Format**: {"message_id": "string", "timestamp": "string"}

### POST /api/v2/sessions/:thread_id/close

**Description**: Close session under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {}

**Response Format**: {"status": "closed", "thread_id": "string"}

### POST /api/v2/search

**Description**: Semantic search under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"query": "string", "thread": "string", "limit": "integer", "min_score": "float"}

**Response Format**: {"results": [{"id": "string", "content": "string", "score": "float", "snippet": "string"}]}

### POST /api/v2/automation/extract/:thread_id

**Description**: Trigger memory extraction under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"auto_save": "boolean"}

**Response Format**: {"extracted_facts": "integer", "extracted_entities": "integer", "extracted_decisions": "integer", "saved": "boolean"}

### POST /api/v2/automation/index/:thread_id

**Description**: Deprecated: Index thread under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### POST /api/v2/automation/index-all

**Description**: Deprecated: Index all threads under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {}

**Response Format**: {"status": "deprecated", "message": "Use /automation/extract instead"}

### GET /api/v2/tenants

**Description**: List tenants under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Response Format**: array of tenant IDs

### POST /api/v2/tenants/switch

**Description**: Switch tenant under v2 API namespace.

**Source File**: `cortex-mem-service/src/main.rs`

**Request Format**: {"tenant_id": "string"}

**Response Format**: {"current_tenant": "string", "success": "boolean"}

## MCP Tools

### store_memory

**Description**: Store a memory message in a session thread. Automatically creates session if not exists.

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `content` (string): required - Memory content to store
- `thread_id` (string): optional - Thread/session ID (defaults to "default")
- `role` (string): optional - Role (user/assistant/system, defaults to "user")

**Response Format**: {"success": "boolean", "uri": "string", "message_id": "string"}

### query_memory

**Description**: Search memories using semantic vector search with L0/L1/L2 layered retrieval.

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `query` (string): required - Natural language query
- `thread_id` (string): optional - Scope to specific thread
- `limit` (integer): optional - Max results (default: 10)
- `min_score` (float): optional - Minimum similarity score (default: 0.6)

**Response Format**: {"results": [{"id": "string", "content": "string", "score": "float", "uri": "string"}]}

### list_memories

**Description**: List memories in a thread with pagination support.

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `thread_id` (string): optional - Thread ID to list
- `limit` (integer): optional - Max results (default: 50)
- `offset` (integer): optional - Pagination offset

**Response Format**: {"memories": [{"id": "string", "uri": "string", "timestamp": "string"}], "total": "integer"}

### get_memory

**Description**: Retrieve a specific memory by URI or ID.

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `uri` (string): required - Memory URI or ID

**Response Format**: {"id": "string", "content": "string", "uri": "string", "metadata": "object"}

### delete_memory

**Description**: Delete a memory and its associated vectors from all layers (L0/L1/L2).

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `uri` (string): required - Memory URI to delete

**Response Format**: {"success": "boolean", "message": "string"}

### get_abstract

**Description**: Get the L0 abstract summary of a memory.

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `uri` (string): required - Memory URI

**Response Format**: {"uri": "string", "abstract_text": "string"}

### generate_layers

**Description**: Generate L0/L1 layer files for memories. Supports session-scoped or full generation.

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `thread_id` (string): optional - Thread ID for session-scoped generation (if omitted, generates for all)

**Response Format**: {"success": "boolean", "message": "string", "total": "integer", "generated": "integer", "failed": "integer"}

### index_memories

**Description**: Index memories to vector database. Supports session-scoped or full indexing.

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `thread_id` (string): optional - Thread ID for session-scoped indexing (if omitted, indexes all)

**Response Format**: {"success": "boolean", "message": "string", "total_files": "integer", "indexed_files": "integer", "skipped_files": "integer", "error_files": "integer"}

### close_session

**Description**: Close a session and trigger final processing (L0/L1 generation, memory extraction, indexing).

**Source File**: `cortex-mem-mcp/src/service.rs`

**Parameters**:
- `thread_id` (string): required - Thread/session ID to close

**Response Format**: {"success": "boolean", "thread_id": "string", "message": "string"}

## Router Routes

### /filesystem/list

**Description**: Lists directory contents under the tenant's data root.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

### /filesystem/read/*path

**Description**: Reads a file at the specified path; wildcard captures full path relative to data root.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

**Parameters**:

- `path` (string): Relative file path within the cortex data directory
### /filesystem/write

**Description**: Writes content to a file; parent directories are auto-created.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

### /filesystem/stats

**Description**: Returns recursive statistics for a directory.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

### /sessions

**Description**: Manages session lifecycle: list or create sessions.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

### /sessions/:thread_id/messages

**Description**: Adds a message to a specific session thread.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /sessions/:thread_id/close

**Description**: Closes a session thread.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /search

**Description**: Performs semantic search using layered vector retrieval.

**Source File**: `cortex-mem-service/src/routes/search.rs`

### /automation/extract/:thread_id

**Description**: Triggers memory extraction from a session thread.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /automation/index/:thread_id

**Description**: Deprecated: Indexes a specific thread.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

**Parameters**:

- `thread_id` (string): Unique identifier of the session thread
### /automation/index-all

**Description**: Deprecated: Indexes all threads.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

### /tenants

**Description**: Lists all available tenants.

**Source File**: `cortex-mem-service/src/routes/tenants.rs`

### /tenants/switch

**Description**: Switches the active tenant context.

**Source File**: `cortex-mem-service/src/routes/tenants.rs`

### /api/v2/*

**Description**: All v2 API routes are nested under this prefix; sub-routes inherit parent path.

**Source File**: `cortex-mem-service/src/main.rs`

**Parameters**:

- `*path` (string): Wildcard matching all sub-path segments under /api/v2
## Integration Suggestions

### HTTP API

Integrate with the HTTP API using authenticated requests and proper error handling.

**Example Code**:

```
import requests

headers = {"Authorization": "Bearer YOUR_API_KEY"}
response = requests.post(
    "http://localhost:8085/api/v2/search",
    json={"query": "user preferences", "thread": "session_123", "limit": 5},
    headers=headers
)
print(response.json())
```

**Best Practices**:

- Always use HTTPS in production
- Include API key in Authorization header
- Validate response status codes
- Implement retry logic for transient failures
- Use connection pooling for high throughput

### CLI

Use the CLI for local development and scripting tasks.

**Example Code**:

```
#!/bin/bash
cortex-mem-cli --config ./config.toml search "recent meeting notes" --scope user --limit 3
```

**Best Practices**:

- Store config files with restricted permissions (600)
- Use environment variables for sensitive values
- Wrap CLI calls in shell scripts for reusability
- Log output for audit trails
- Validate inputs before execution

### MCP (stdio)

Connect via stdio to the MCP server for agent-based communication.

**Example Code**:

```
#!/bin/bash
cortex-mem-mcp --config config.toml
# Then send JSON over stdin:
echo '{"method": "search", "params": {"query": "urgent task"}}' | cortex-mem-mcp --config config.toml
```

**Best Practices**:

- Use structured JSON for all messages
- Implement message framing (e.g., newline-delimited)
- Handle stdio buffering and timeouts
- Validate schema of incoming/outgoing messages
- Use logging for debugging IPC flows

### Web UI (Svelte)

Integrate with the Svelte frontend using the API endpoints.

**Example Code**:

```
import { writable } from 'svelte/store';

export const searchResults = writable([]);

export async function search(query) {
  const res = await fetch('/api/v2/search', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ query, thread: 'current_session' })
  });
  searchResults.set(await res.json());
}
```

---

**Analysis Confidence**: 9.5/10

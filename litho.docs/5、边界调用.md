# 系统边界接口文档

本文档描述了系统的外部调用接口，包括CLI命令、API端点、配置参数等边界机制。

## 命令行接口 (CLI)

### memo

**描述**: Rust Agent Memory System CLI，用于管理记忆库的命令行工具

**源文件**: `memo-cli/src/main.rs`

**参数**:

- `config` (PathBuf): 可选 - 配置文件路径，默认为config.toml (默认: `config.toml`)

**选项**:

- `add`(String): 可选 - 添加新记忆
- `search`(String): 可选 - 搜索记忆
- `list`(String): 可选 - 列出记忆
- `delete`(String): 可选 - 删除记忆

**使用示例**:

```bash
memo add --content "今天学习了Rust的async/await语法" --user-id "user123" --memory-type "factual"
```

```bash
memo search --query "Rust" --user-id "user123" --limit 5
```

```bash
memo list --user-id "user123" --memory-type "conversational"
```

```bash
memo delete "memory-uuid-123"
```

### multi-round-interactive

**描述**: 多轮交互式记忆助手，提供TUI界面与记忆系统交互

**源文件**: `examples/multi-round-interactive/src/main.rs`

**参数**:

- `config` (PathBuf): 可选 - 配置文件路径，默认为'config.toml' (默认: `config.toml`)

**使用示例**:

```bash
multi-round-interactive
```

```bash
multi-round-interactive --config custom-config.toml
```

### memo-service

**描述**: Rust Agent Memory System HTTP Service，启动记忆系统的HTTP服务

**源文件**: `memo-service/src/main.rs`

**参数**:

- `config` (PathBuf): 可选 - 配置文件路径 (默认: `config.toml`)

**使用示例**:

```bash
memo-service
```

```bash
memo-service --config /path/to/config.toml
```

## API接口

### GET /health

**描述**: 健康检查端点，返回服务及依赖组件的健康状态

**源文件**: `memo-service/src/main.rs`

**响应格式**: JSON包含服务整体状态、向量存储状态、LLM服务状态和时间戳

### POST /memories

**描述**: 创建新记忆条目，支持对话和程序性记忆类型

**源文件**: `memo-service/src/main.rs`

**请求格式**: JSON包含内容、用户ID、Agent ID、记忆类型等字段

**响应格式**: JSON包含操作结果、消息和记忆ID

### POST /memories/search

**描述**: 根据查询内容和过滤条件搜索相似的记忆

**源文件**: `memo-service/src/main.rs`

**请求格式**: JSON包含查询字符串、用户ID、Agent ID、相似度阈值和结果限制

**响应格式**: JSON包含总结果数和匹配的记忆列表及其相似度分数

### GET /memories/:id

**描述**: 根据ID获取单个记忆

**源文件**: `memo-service/src/main.rs`

**响应格式**: JSON包含记忆的完整信息，包括ID、内容、元数据和时间戳

### GET /memories

**描述**: 根据过滤条件列出记忆

**源文件**: `memo-service/src/main.rs`

**请求格式**: 查询参数包含用户ID、Agent ID、记忆类型和结果限制

**响应格式**: JSON包含总结果数和记忆列表

### PUT /memories/:id

**描述**: 更新现有记忆的内容

**源文件**: `memo-service/src/handlers.rs`

**请求格式**: JSON包含要更新的内容

**响应格式**: JSON包含操作结果和更新后的记忆ID

### DELETE /memories/:id

**描述**: 删除指定ID的记忆

**源文件**: `memo-service/src/handlers.rs`

**响应格式**: JSON包含操作结果和被删除的记忆ID

## Router路由

### /health

**描述**: 健康检查路由

**源文件**: `memo-service/src/main.rs`

### /memories

**描述**: 记忆管理主路由

**源文件**: `memo-service/src/main.rs`

### /memories/search

**描述**: 记忆搜索路由

**源文件**: `memo-service/src/main.rs`

### /memories/:id

**描述**: 基于ID的记忆操作路由

**源文件**: `memo-service/src/main.rs`

**参数**:

- `id` (String): 记忆的唯一标识符
## 集成建议

### CLI集成

通过CLI命令与记忆系统交互，适合自动化脚本和命令行工作流

**示例代码**:

```
memo add --content "完成项目文档编写" --user-id "developer1" --memory-type "factual"

memo search --query "项目文档" --user-id "developer1"
```

**最佳实践**:

- 在shell脚本中使用CLI命令实现自动化知识记录
- 结合cron定时任务定期备份重要记忆
- 使用管道将其他命令的输出作为记忆内容存储
- 为不同用户和场景创建专用的配置文件

### API集成

通过HTTP API与记忆系统集成，适合Web应用和微服务架构

**示例代码**:

```
import requests

# 创建新记忆
data = {
    "content": "用户反馈了新的功能需求",
    "user_id": "user123",
    "agent_id": "support-agent",
    "memory_type": "conversational"
}

response = requests.post("http://localhost:8080/memories", json=data)
print(response.json())

# 搜索记忆
search_data = {
    "query": "功能需求",
    "user_id": "user123"
}
search_response = requests.post("http://localhost:8080/memories/search", json=search_data)
print(search_response.json())
```

**最佳实践**:

- 使用连接池管理API请求，提高性能
- 实现重试机制处理临时性网络错误
- 缓存频繁查询的结果以减少API调用
- 使用HTTPS保护数据传输安全
- 实现请求限流防止服务过载

### 配置管理

通过配置文件定制系统行为，实现环境化部署

**示例代码**:

```
# config.toml

[qdrant]
url = "http://localhost:6334"
collection_name = "memories"
embedding_dim = 1536
timeout_secs = 30

[llm]
api_base_url = "https://api.openai.com/v1"
api_key = "your-openai-api-key"
model_efficient = "gpt-3.5-turbo"
temperature = 0.7
max_tokens = 2048

[server]
host = "0.0.0.0"
port = 8080
cors_origins = ["http://localhost:3000", "https://your-app.com"]

[memory]
max_memories = 10000
similarity_threshold = 0.65
max_search_results = 50
auto_summary_threshold = 32768
auto_enhance = true
deduplicate = true
merge_threshold = 0.75
search_similarity_threshold = 0.7
```

**最佳实践**:

- 为不同环境（开发、测试、生产）使用不同的配置文件
- 使用环境变量覆盖敏感配置（如API密钥）
- 定期备份配置文件
- 使用配置文件版本控制
- 在配置变更时重新加载服务或重启

### 安全建议

确保系统安全的最佳实践

**示例代码**:

```
# 使用环境变量存储敏感信息
import os
from dotenv import load_dotenv

load_dotenv()

# 从环境变量获取API密钥
api_key = os.getenv('LLM_API_KEY')

config = {
    "llm": {
        "api_key": api_key,
        "api_base_url": "https://api.openai.com/v1"
    }
}
```

**最佳实践**:

- 不要在代码或配置文件中硬编码API密钥
- 使用HTTPS加密所有API通信
- 实现适当的认证和授权机制
- 对用户输入进行验证和清理，防止注入攻击
- 限制API的访问来源（CORS策略）
- 监控异常访问模式
- 定期轮换API密钥
- 实施请求速率限制


---

**分析置信度**: 0.9/10

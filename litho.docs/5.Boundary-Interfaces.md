# System Boundary Interface Documentation

This document describes the system's external invocation interfaces, including CLI commands, API endpoints, configuration parameters, and other boundary mechanisms.

## Command Line Interface (CLI)

### cortex-mem-cli

**Description**: Command-line interface for managing memory operations including add, search, list, get, delete, session, automation, and stats.

**Source File**: `cortex-mem-cli/src/main.rs`

**Arguments**:

- `subcommand` (string): required - The subcommand to execute (add, search, list, get, delete, session, automation, stats)

**Options**:

- `config`(string): optional - Path to config.toml file
- `verbose`(boolean): optional - Enable verbose logging (default: `false`)
- `llm-model`(string): optional - Specify LLM model to use

**Usage Examples**:

```bash
cortex-mem-cli add --config ./config.toml
```

```bash
cortex-mem-cli search --verbose "important note"
```

```bash
cortex-mem-cli list --llm-model gpt-4
```

### cortex-mem-mcp

**Description**: MCP server that exposes memory operations via JSON-RPC over stdio.

**Source File**: `cortex-mem-mcp/src/main.rs`

**Arguments**:

- `config` (string): optional - Path to configuration file

**Options**:

- `agent`(string): optional - Specify agent identifier
- `user`(string): optional - Specify user identifier
- `verbose`(boolean): optional - Enable verbose logging (default: `false`)

**Usage Examples**:

```bash
cortex-mem-mcp --config ./mcp-config.toml
```

```bash
cortex-mem-mcp --agent bot-123 --user alice
```

### cortex-mem-tars

**Description**: TARS CLI for enhanced memory operations with audio and vector search features.

**Source File**: `examples/cortex-mem-tars/src/main.rs`

**Options**:

- `enhance-memory-saver`(boolean): optional - Enable enhanced memory saving logic (default: `false`)
- `enable-audio-connect`(boolean): optional - Enable audio connection for memory capture (default: `false`)
- `enhance-vector-search`(boolean): optional - Enable advanced vector search capabilities (default: `false`)
- `config`(string): optional - Path to config.toml

**Usage Examples**:

```bash
cortex-mem-tars --enhance-memory-saver --enable-audio-connect
```

```bash
cortex-mem-tars --config ./tars-config.toml --enhance-vector-search
```

### cortex-mem-service

**Description**: HTTP service exposing memory APIs via Axum on a specified host and port.

**Source File**: `cortex-mem-service/src/main.rs`

**Options**:

- `data-dir`(string): required - Directory for persistent memory storage
- `host`(string): optional - Host to bind the server to (default: `127.0.0.1`)
- `port`(integer): optional - Port to bind the server to (default: `3000`)
- `verbose`(boolean): optional - Enable verbose logging (default: `false`)

**Usage Examples**:

```bash
cortex-mem-service --data-dir /var/cortex-mem --host 0.0.0.0 --port 8080
```

```bash
cortex-mem-service --data-dir ./data --verbose
```

## API Interfaces

### GET /api/v2/health

**Description**: Returns system health status including service version, LLM availability, and timestamp.

**Source File**: `cortex-mem-service/src/handlers/health.rs`

**Response Format**: {"status": "string", "service": "string", "version": "string", "llm_available": "boolean", "timestamp": "string"}

### GET /api/v2/filesystem/list

**Description**: Lists contents of the filesystem memory store at the specified path.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: {"files": ["string"], "directories": ["string"]}

### GET /api/v2/filesystem/read/*path

**Description**: Reads content from a specific file path in the filesystem memory store. Path must start with 'cortex://'.

**Source File**: `cortex-mem-service/src/handlers/filesystem.rs`

**Response Format**: {"content": "string"}

### POST /api/v2/sessions

**Description**: Creates a new session with optional metadata.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {"metadata": {"key": "string"}}

**Response Format**: {"session_id": "string", "created_at": "string"}

### GET /api/v2/sessions

**Description**: Lists all active sessions.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Response Format**: [{"session_id": "string", "created_at": "string", "status": "string"}]

### POST /api/v2/sessions/:thread_id/messages

**Description**: Adds a message to a specific session thread.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Request Format**: {"content": "string", "role": "string"}

**Response Format**: {"message_id": "string", "timestamp": "string"}

### POST /api/v2/sessions/:thread_id/close

**Description**: Closes a session thread.

**Source File**: `cortex-mem-service/src/handlers/sessions.rs`

**Response Format**: {"status": "closed"}

### POST /api/v2/search

**Description**: Performs memory search using filesystem, vector, or hybrid modes. Supports filtering and pagination.

**Source File**: `cortex-mem-service/src/handlers/search.rs`

**Request Format**: {"query": "string", "mode": "filesystem|vector|hybrid", "limit": "integer", "offset": "integer"}

**Response Format**: {"results": [{"id": "string", "content": "string", "score": "number", "metadata": {"key": "string"}}]}

### POST /api/v2/automation/extract/:thread_id

**Description**: Triggers memory extraction from a thread using LLM and embedding models.

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Response Format**: {"extracted_count": "integer", "failed_count": "integer", "job_id": "string"}

### POST /api/v2/automation/index/:thread_id

**Description**: Triggers indexing of a thread's memory into vector store.

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Response Format**: {"indexed_count": "integer", "job_id": "string"}

### POST /api/v2/automation/index-all

**Description**: Triggers indexing of all threads into vector store.

**Source File**: `cortex-mem-service/src/handlers/automation.rs`

**Response Format**: {"total_threads": "integer", "indexed_threads": "integer"}

### GET /api/memories

**Description**: Lists all stored memories via Elysia API. Returns paginated results with metadata.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Response Format**: {"memories": [{"id": "string", "content": "string", "created_at": "string", "tags": ["string"]}], "pagination": {"total": "integer", "page": "integer", "limit": "integer"}}

### POST /api/memories

**Description**: Creates a new memory entry with content and optional metadata.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Request Format**: {"content": "string", "metadata": {"key": "string"}}

**Response Format**: {"id": "string", "created_at": "string"}

### GET /api/memories/:id

**Description**: Retrieves a specific memory by ID.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Response Format**: {"id": "string", "content": "string", "metadata": {"key": "string"}, "created_at": "string"}

### PUT /api/memories/:id

**Description**: Updates an existing memory entry.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Request Format**: {"content": "string", "metadata": {"key": "string"}}

**Response Format**: {"id": "string", "updated_at": "string"}

### DELETE /api/memories/:id

**Description**: Deletes a memory entry by ID.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Response Format**: {"deleted": "boolean"}

### POST /api/memories/batch-delete

**Description**: Deletes multiple memories by IDs in a single request.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Request Format**: {"ids": ["string"]}

**Response Format**: {"deleted_count": "integer", "failed_ids": ["string"]}

### POST /api/memories/search

**Description**: Searches memories using full-text or semantic query.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Request Format**: {"query": "string", "limit": "integer", "offset": "integer"}

**Response Format**: {"results": [{"id": "string", "content": "string", "score": "number", "metadata": {"key": "string"}}]}

### GET /api/memories/stats

**Description**: Returns memory statistics including total count, average length, and tag distribution.

**Source File**: `cortex-mem-insights/src/server/api/memory.ts`

**Response Format**: {"total_memories": "integer", "avg_length": "number", "tag_distribution": {"tag": "integer"}}

### POST /api/optimization

**Description**: Starts an optimization job with specified strategy and parameters.

**Source File**: `cortex-mem-insights/src/server/api/optimization.ts`

**Request Format**: {"strategy": "aggressive|balanced|conservative", "dry_run": "boolean", "include_tags": ["string"], "exclude_tags": ["string"]}

**Response Format**: {"job_id": "string", "status": "pending", "started_at": "string"}

### GET /api/optimization/:job_id

**Description**: Retrieves status and progress of a specific optimization job.

**Source File**: `cortex-mem-insights/src/server/api/optimization.ts`

**Response Format**: {"job_id": "string", "status": "string", "progress": "number", "completed_at": "string", "summary": {"removed": "integer", "archived": "integer"}}

### POST /api/optimization/:job_id/cancel

**Description**: Cancels an ongoing optimization job.

**Source File**: `cortex-mem-insights/src/server/api/optimization.ts`

**Response Format**: {"canceled": "boolean", "job_id": "string"}

### GET /api/optimization/history

**Description**: Retrieves history of completed optimization jobs.

**Source File**: `cortex-mem-insights/src/server/api/optimization.ts`

**Response Format**: {"jobs": [{"job_id": "string", "strategy": "string", "status": "string", "started_at": "string", "completed_at": "string"}]}

### POST /api/optimization/analyze

**Description**: Analyzes memory patterns to recommend optimization strategies.

**Source File**: `cortex-mem-insights/src/server/api/optimization.ts`

**Request Format**: {"filter_tags": ["string"], "timeframe": "string"}

**Response Format**: {"recommended_strategy": "string", "confidence": "number", "predicted_savings": "number", "issues": [{"type": "string", "count": "integer"}]}

### GET /api/optimization/statistics

**Description**: Returns aggregated optimization statistics across all jobs.

**Source File**: `cortex-mem-insights/src/server/api/optimization.ts`

**Response Format**: {"total_jobs": "integer", "success_rate": "number", "total_memories_optimized": "integer", "avg_savings_per_job": "number"}

### GET /api/system/health

**Description**: Returns combined health status of Cortex-Mem service and underlying components.

**Source File**: `cortex-mem-insights/src/server/api/system.ts`

**Response Format**: {"cortex_mem": {"status": "string", "version": "string"}, "llm": {"available": "boolean", "model": "string"}, "vector_store": {"connected": "boolean", "collection": "string"}, "timestamp": "string"}

### GET /api/system/metrics

**Description**: Returns system resource usage metrics (CPU, memory, disk).

**Source File**: `cortex-mem-insights/src/server/api/system.ts`

**Response Format**: {"cpu_percent": "number", "memory_mb": "number", "disk_used_gb": "number", "disk_total_gb": "number"}

### GET /api/system/logs

**Description**: Returns recent system logs (last 100 lines).

**Source File**: `cortex-mem-insights/src/server/api/system.ts`

**Response Format**: {"logs": ["string"], "count": "integer"}

### POST /api/system/clear-cache

**Description**: Clears internal caches (e.g., LLM embeddings, vector indices).

**Source File**: `cortex-mem-insights/src/server/api/system.ts`

**Response Format**: {"cleared": "boolean", "cache_types": ["string"]}

### POST /api/system/restart

**Description**: Triggers a graceful restart of the Cortex-Mem insights server.

**Source File**: `cortex-mem-insights/src/server/api/system.ts`

**Response Format**: {"restarting": "boolean", "shutdown_in_seconds": "integer"}

### GET /api/system/llm/status

**Description**: Checks LLM service availability and model details.

**Source File**: `cortex-mem-insights/src/server/api/system.ts`

**Response Format**: {"available": "boolean", "model": "string", "base_url": "string", "max_tokens": "integer", "temperature": "number"}

### GET /api/system/llm/health

**Description**: Performs health check on LLM provider endpoint.

**Source File**: `cortex-mem-insights/src/server/api/system.ts`

**Response Format**: {"healthy": "boolean", "latency_ms": "number", "error": "string"}

### POST /tools/list

**Description**: JSON-RPC method to list available MCP tools (e.g., store_memory, query_memory).

**Source File**: `cortex-mem-mcp/src/server.rs`

**Request Format**: {"jsonrpc": "2.0", "method": "tools/list", "id": "integer"}

**Response Format**: {"jsonrpc": "2.0", "result": [{"name": "string", "description": "string", "input_schema": {"type": "object"}}], "id": "integer"}

### POST /tools/call

**Description**: JSON-RPC method to invoke a specific MCP tool (e.g., store_memory, get_memory).

**Source File**: `cortex-mem-mcp/src/server.rs`

**Request Format**: {"jsonrpc": "2.0", "method": "tools/call", "params": {"tool": "string", "arguments": {"key": "value"}}, "id": "integer"}

**Response Format**: {"jsonrpc": "2.0", "result": {}, "id": "integer"}

## Router Routes

### /filesystem

**Description**: Routes for filesystem memory operations including list and read.

**Source File**: `cortex-mem-service/src/routes/filesystem.rs`

**Parameters**:

- `path` (string): Path within cortex:// filesystem to read or list
### /automation/extract/:thread_id

**Description**: Triggers memory extraction for a specific thread.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

**Parameters**:

- `thread_id` (string): Identifier of the thread to extract memory from
### /automation/index/:thread_id

**Description**: Triggers vector indexing for a specific thread.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

**Parameters**:

- `thread_id` (string): Identifier of the thread to index
### /automation/index-all

**Description**: Triggers vector indexing for all threads.

**Source File**: `cortex-mem-service/src/routes/automation.rs`

### /sessions

**Description**: Manages conversation sessions including creation, listing, and message handling.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

### /sessions/:thread_id/messages

**Description**: Adds a message to a session thread.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

**Parameters**:

- `thread_id` (string): Identifier of the session thread to add message to
### /sessions/:thread_id/close

**Description**: Closes a session thread.

**Source File**: `cortex-mem-service/src/routes/sessions.rs`

**Parameters**:

- `thread_id` (string): Identifier of the session thread to close
### /search

**Description**: Performs memory search using filesystem, vector, or hybrid modes.

**Source File**: `cortex-mem-service/src/routes/search.rs`

### /

**Description**: Dashboard page showing memory statistics, recent memories, and quick actions.

**Source File**: `cortex-mem-insights/src/routes/+page.svelte`

### /optimization

**Description**: Optimization dashboard for managing memory optimization jobs and strategies.

**Source File**: `cortex-mem-insights/src/routes/optimization/+page.svelte`

## Integration Suggestions

### API

Integrate with Cortex-Mem HTTP API using authenticated requests.

**Example Code**:

```
const response = await fetch('https://localhost:3000/api/memories', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ content: 'New memory entry', metadata: { source: 'user' } })
});
const data = await response.json();
```

**Best Practices**:

- Always use HTTPS in production
- Include Authorization header with JWT or API key
- Validate response schema before processing
- Implement retry logic with exponential backoff for transient failures
- Use environment variables for API endpoints and keys

### CLI

Use CLI tools to manage memory from scripts or CI/CD pipelines.

**Example Code**:

```
# Add a memory entry
./cortex-mem-cli add "Important note" --config ./config.toml

# Search memories
./cortex-mem-cli search "project deadline" --verbose

# List sessions
./cortex-mem-cli list sessions
```

**Best Practices**:

- Use config files to avoid exposing API keys in shell history
- Validate CLI output with jq or similar tools
- Wrap CLI calls in shell scripts for reusability
- Log CLI execution for audit trails
- Use --dry-run flags where available to test before execution

### MCP

Connect to Cortex-Mem via JSON-RPC MCP interface for agent-based integrations.

**Example Code**:

```
const request = {
  jsonrpc: "2.0",
  method: "tools/call",
  params: {
    tool: "store_memory",
    arguments: {
      content: "User's thought about project",
      metadata: { source: "agent", timestamp: new Date().toISOString() }
    }
  },
  id: 1
};

// Send over stdio to cortex-mem-mcp process
const child = spawn('./cortex-mem-mcp');
child.stdin.write(JSON.stringify(request) + '\n');
```

**Best Practices**:

- Authenticate MCP clients via initialize method with token
- Validate tool input schemas before calling
- Use unique request IDs for request-response correlation
- Handle RPC errors gracefully with fallback mechanisms
- Avoid exposing MCP interface to untrusted networks

### Frontend

Integrate frontend dashboard with Cortex-Mem Insights API via Vite proxy.

**Example Code**:

```
import { memoryApi } from '@/lib/api/client';

export async function loadMemories() {
  const { data } = await memoryApi.list({ limit: 10, offset: 0 });
  return data.memories;
}

export async function createMemory(content: string) {
  const { data } = await memoryApi.create({ content, metadata: { origin: 'web' } });
  return data.id;
}
```

**Best Practices**:

- Use Vite proxy to avoid CORS issues during development
- Cache API responses with SWR or React Query
- Implement loading/error states for all API calls
- Use i18n t() function for all UI text
- Validate user inputs before sending to API to prevent injection


---

**Analysis Confidence**: 9.5/10

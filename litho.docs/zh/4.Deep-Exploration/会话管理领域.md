**æŠ€æœ¯æ–‡æ¡£ï¼šä¼šè¯ç®¡ç†é¢†åŸŸ**

**Cortex-Mem ç³»ç»Ÿæ¶æ„**  
**ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2026-02-17 16:40:50 (UTC)

---

## 1. æ‰§è¡Œæ‘˜è¦

**ä¼šè¯ç®¡ç†é¢†åŸŸ**æ˜¯ Cortex-Mem æ¶æ„å†…çš„æ ¸å¿ƒä¸šåŠ¡é¢†åŸŸï¼Œè´Ÿè´£å…¨é¢çš„å¯¹è¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚å®ƒä¸ºç»„ç»‡å¤šè½®å¯¹è¯æä¾›åŸºç¡€æ€§åŸºç¡€è®¾æ–½ï¼Œå…·æœ‰å®Œæ•´çš„æ—¶é—´ä¸Šä¸‹æ–‡ã€æŒä¹…åŒ–å­˜å‚¨å’Œè‡ªåŠ¨åŒ–è¯­ä¹‰ç´¢å¼•åŠŸèƒ½ã€‚

è¯¥é¢†åŸŸå®ç°äº†ä¸€ä¸ªæœ‰çŠ¶æ€çš„ä¼šè¯ç¼–æ’ç³»ç»Ÿï¼Œæ•è·å¯¹è¯æ—¶é—´çº¿ï¼Œç®¡ç†å‚ä¸è€…è§’è‰²ï¼Œå¹¶åœ¨ä¼šè¯å…³é—­æ—¶è§¦å‘æ™ºèƒ½å†…å®¹å¤„ç†ç®¡é“ã€‚é€šè¿‡ä¸å­˜å‚¨åŸºç¡€è®¾æ–½ã€LLM é›†æˆå’Œå‘é‡æœç´¢é¢†åŸŸçš„é›†æˆï¼Œå®ƒå®ç°äº†å¯¹è¯å†å²çš„æ—¶é—´å¯¼èˆªå’Œè¯­ä¹‰æ£€ç´¢ã€‚

**å…³é”®èƒ½åŠ›ï¼š**
- å±‚æ¬¡ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆæ´»è·ƒ â†’ å…³é—­ â†’ å·²å½’æ¡£ï¼‰
- å¸¦ URI å¯å¯»å€çš„æ—¶é—´æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆ`cortex://session/`ï¼‰
- å¯¹è¯å†…å®¹çš„è‡ªåŠ¨åŒ–å‘é‡ç´¢å¼•åˆ° Qdrant
- LLM é©±åŠ¨çš„ç»“æ„åŒ–è®°å¿†æå–ï¼ˆåå¥½ã€å®ä½“ã€äº‹ä»¶ã€æ¡ˆä¾‹ï¼‰
- å¤šæ–¹å‚ä¸è€…è·Ÿè¸ªä¸åŸºäºè§’è‰²çš„åˆ†ç±»

---

## 2. æ¶æ„æ¦‚è¿°

### 2.1 é¢†åŸŸä½ç½®

ä¼šè¯ç®¡ç†é¢†åŸŸä½œä¸ºæ ¸å¿ƒä¸šåŠ¡é¢†åŸŸåœ¨ Cortex-Mem åˆ†ï¼Œä¸å±‚æ¶æ„ä¸­è¿è¡ŒåŸºç¡€è®¾æ–½å’ŒåŒçº§ä¸šåŠ¡é¢†åŸŸä¿æŒæ¸…æ™°çš„ä¾èµ–å…³ç³»ï¼š

```mermaid
flowchart TB
    subgraph SessionDomain["ä¼šè¯ç®¡ç†é¢†åŸŸ"]
        SM[ä¼šè¯ç®¡ç†å™¨]
        MS[æ¶ˆæ¯å­˜å‚¨]
        TG[æ—¶é—´çº¿ç”Ÿæˆå™¨]
        AI[è‡ªåŠ¨ç´¢å¼•å™¨]
        ME[è®°å¿†æå–å™¨]
        PM[å‚ä¸è€…ç®¡ç†å™¨]
    end
    
    subgraph Dependencies["å¤–éƒ¨ä¾èµ–"]
        FS[(å­˜å‚¨åŸºç¡€è®¾æ–½<br/>æ–‡ä»¶ç³»ç»Ÿæ“ä½œ)]
        LLM[LLM é›†æˆé¢†åŸŸ]
        VS[å‘é‡æœç´¢é¢†åŸŸ]
        MM[è®°å¿†ç®¡ç†é¢†åŸŸ]
    end
    
    SM -->|æŒä¹…åŒ–å…ƒæ•°æ®| FS
    MS -->|å†™å…¥ Markdown| FS
    TG -->|ç”Ÿæˆç´¢å¼•| FS
    AI -->|å‘é‡å­˜å‚¨| VS
    AI -->|åµŒå…¥| LLM
    ME -->|æå–| LLM
    ME -->|ä¿å­˜è®°å¿†| MM
    SM -->|è·Ÿè¸ª| PM
    
    style SessionDomain fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
```

### 2.2 ç»„ä»¶å±‚æ¬¡ç»“æ„

| ç»„ä»¶ | èŒè´£ | ä¸»è¦æ–‡ä»¶ |
|-----------|---------------|--------------|
| **ä¼šè¯ç®¡ç†å™¨** | ç”Ÿå‘½å‘¨æœŸç¼–æ’ã€çŠ¶æ€è½¬æ¢ã€å…ƒæ•°æ®ç®¡ç† | `cortex-mem-core/src/session/manager.rs` |
| **æ¶ˆæ¯å­˜å‚¨** | æ—¶é—´æŒä¹…åŒ–ã€markdown åºåˆ—åŒ–ã€URI ç”Ÿæˆ | `cortex-mem-core/src/session/message.rs` |
| **æ—¶é—´çº¿ç”Ÿæˆå™¨** | å±‚æ¬¡ç´¢å¼•ç”Ÿæˆï¼ˆæ—¥/æœˆ/å¹´ï¼‰ | `cortex-mem-core/src/session/timeline.rs` |
| **è‡ªåŠ¨ç´¢å¼•å™¨** | å‘é‡æ•°æ®åº“ç´¢å¼•ã€æ‰¹å¤„ç†ã€å»é‡ | `cortex-mem-core/src/automation/indexer.rs` |
| **è®°å¿†æå–å™¨** | ä¼šè¯å…³é—­æ—¶çš„ LLM é©±åŠ¨çš„ç»“æ„åŒ–æå– | `cortex-mem-core/src/session/extraction.rs` |
| **å‚ä¸è€…ç®¡ç†å™¨** | å¤šæ–¹å‚ä¸è€…æ³¨å†Œå’Œè§’è‰²åˆ†é… | `cortex-mem-core/src/session/participant.rs` |

---

## 3. æ ¸å¿ƒå·¥ä½œæµ

### 3.1 ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†

ä¼šè¯ç”Ÿå‘½å‘¨æœŸéµå¾ªçŠ¶æ€æœºæ¨¡å¼ï¼Œå…·æœ‰ä¸‰ç§ä¸åŒçš„çŠ¶æ€ï¼Œä¿å­˜åœ¨ `.session.json` å…ƒæ•°æ®æ–‡ä»¶ä¸­ï¼š

**çŠ¶æ€è½¬æ¢ï¼š**
```
æ´»è·ƒ â†’ å…³é—­ â†’ å·²å½’æ¡£
```

**æ“ä½œæµç¨‹ï¼š**

```mermaid
sequenceDiagram
    autonumber
    participant C as å®¢æˆ·ç«¯
    participant SM as ä¼šè¯ç®¡ç†å™¨
    participant FS as Cortexæ–‡ä»¶ç³»ç»Ÿ
    participant ME as è®°å¿†æå–å™¨
    participant LLM as LLMå®¢æˆ·ç«¯
    
    rect rgb(230, 245, 230)
        Note over C,FS: ä¼šè¯åˆå§‹åŒ–
        C->>SM: create_session(thread_id)
        SM->>FS: å†™å…¥ .session.json
        Note right of FS: cortex://session/{thread_id}/<br/>.session.json
        SM-->>C: SessionMetadata (æ´»è·ƒ)
    end
    
    rect rgb(255, 243, 224)
        Note over C,FS: æ¶ˆæ¯ç´¯ç§¯
        loop æ¶ˆæ¯å¾ªç¯
            C->>SM: append_message(role, content)
            SM->>FS: å†™å…¥ timeline/{YYYY-MM}/{DD}/{HH_MM_SS}_{id}.md
        end
    end
    
    rect rgb(227, 242, 253)
        Note over C,LLM: ä¼šè¯å…³é—­å’Œæå–
        C->>SM: close_session(thread_id)
        SM->>FS: æ›´æ–°çŠ¶æ€ä¸ºå…³é—­
        
        opt å¯ç”¨ auto_extract_on_close
            SM->>ME: extract(messages)
            ME->>LLM: åˆ†æå¯¹è¯
            LLM-->>ME: ç»“æ„åŒ– JSON
            ME->>FS: å†™å…¥ user/ & agent/ ç»´åº¦
        end
        
        SM-->>C: SessionMetadata (å…³é—­)
    end
```

**å®ç°ç»†èŠ‚ï¼š**
- ä¼šè¯å…ƒæ•°æ®å­˜å‚¨åœ¨ `cortex://session/{thread_id}/.session.json`
- çŠ¶æ€è½¬æ¢æ˜¯åŸå­æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- å…³é—­æ ¹æ® `SessionConfig.auto_extract_on_close` æ ‡å¿—è§¦å‘æ¡ä»¶è®°å¿†æå–
- æ”¯æŒé€šè¿‡ `parent_thread_id` è¿›è¡Œå¯¹è¯çº¿ç¨‹çš„å±‚æ¬¡ç»„ç»‡

### 3.2 æ—¶é—´æ¶ˆæ¯æŒä¹…åŒ–

æ¶ˆæ¯ä½¿ç”¨å±‚æ¬¡æ—¥æœŸç›®å½•ç»“æ„è¿›è¡ŒæŒä¹…åŒ–ï¼Œæ”¯æŒé«˜æ•ˆçš„æ—¶é—´æŸ¥è¯¢å’Œæ‰‹åŠ¨å¯¼èˆªï¼š

**URI æ¨¡å¼ï¼š**
```
cortex://session/{thread_id}/timeline/{YYYY-MM}/{DD}/{HH_MM_SS}_{message_id}.md
```

**å­˜å‚¨æ ¼å¼ï¼š**
æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå¸¦ç»“æ„åŒ–å…ƒæ•°æ®å¤´çš„ Markdownï¼š

```markdown
---
id: msg_001
role: user
timestamp: 2024-01-15T14:30:00Z
thread_id: thread_abc123
---

ğŸ‘¤ **ç”¨æˆ·** (2024-01-15 14:30)

æ¶ˆæ¯å†…å®¹...
```

**å·¥å‚æ–¹æ³•ï¼š**
`MessageStorage` ç»„ä»¶æä¾›è§’è‰²ç‰¹å®šçš„å·¥å‚æ–¹æ³•ï¼š
- `MessageStorage::user(content)` â†’ Role::User
- `MessageStorage::assistant(content)` â†’ Role::Assistant  
- `MessageStorage::system(content)` â†’ Role::System

### 3.3 è‡ªåŠ¨åŒ–å‘é‡ç´¢å¼•

è‡ªåŠ¨ç´¢å¼•å™¨å®ç°ç”¨äºå¯¹è¯å†…å®¹è¯­ä¹‰ç´¢å¼•çš„æ‰¹å¤„ç†ç®¡é“ï¼š

**ç´¢å¼•å·¥ä½œæµï¼š**

```mermaid
flowchart LR
    A[æ‰«ææ—¶é—´çº¿<br/>ç›®å½•] --> B[è§£æ Markdown<br/>æ¶ˆæ¯]
    B --> C[å»é‡<br/>æ£€æŸ¥ VS]
    C --> D[æ‰¹é‡åµŒå…¥<br/>ç”Ÿæˆ]
    D --> E[å‘é‡å­˜å‚¨<br/>æ’å…¥]
    E --> F[è¿›åº¦<br/>å›è°ƒ]
    
    style D fill:#e3f2fd,stroke:#1565c0
    style E fill:#fff3e0,stroke:#ef6c00
```

**æŠ€æœ¯è§„æ ¼ï¼š**
- **æ‰¹é‡å¤§å°**ï¼šå¯é…ç½®ï¼Œé»˜è®¤æ¯æ‰¹ 10 æ¡æ¶ˆæ¯
- **å»é‡**ï¼šä½¿ç”¨ `scroll_ids()` æŸ¥è¯¢åœ¨å¤„ç†å‰æ£€æŸ¥ç°æœ‰å‘é‡ ID
- **å‘é‡ ID æ ¼å¼**ï¼š`cortex://session/{thread_id}/messages/{message_id}`
- **å¼‚æ­¥å¤„ç†**ï¼šéé˜»å¡ç´¢å¼•ï¼Œå¸¦ UI åé¦ˆçš„è¿›åº¦å›è°ƒ
- **å†…å®¹æå–**ï¼šè§£æ markdown å†…å®¹ï¼Œæ’é™¤å…ƒæ•°æ®å¤´è¿›è¡ŒåµŒå…¥

**é…ç½®ï¼š**
```rust
IndexerConfig {
    auto_index: bool,      // å¯ç”¨å“åº”å¼ç´¢å¼•
    batch_size: usize,     // é»˜è®¤ï¼š10
    async_index: bool,     // åå°å¤„ç†
}
```

### 3.4 ç»“æ„åŒ–è®°å¿†æå–

ä¼šè¯å…³é—­æ—¶ï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨ LLM åˆ†æè‡ªåŠ¨æå–ç»“æ„åŒ–è®°å¿†ï¼Œå®ç° OpenViking é£æ ¼çš„æå–æ¨¡å¼ï¼š

**æå–ç±»åˆ«ï¼š**
1. **åå¥½**ï¼šç”¨æˆ·åå¥½ã€å–œæ¬¢/ä¸å–œæ¬¢ã€è®¾ç½®
2. **å®ä½“**ï¼šå‘½åå®ä½“ã€äººã€ç»„ç»‡ã€åœ°ç‚¹
3. **äº‹ä»¶**ï¼šé‡å¤§äº‹ä»¶ã€é‡Œç¨‹ç¢‘ã€å†³ç­–
4. **æ¡ˆä¾‹**ï¼šä»£ç†ç‰¹å®šçš„é—®é¢˜è§£å†³æ¨¡å¼å’Œè§£å†³æ–¹æ¡ˆ

**æŒä¹…åŒ–ç›®æ ‡ï¼š**
- åå¥½ â†’ `cortex://user/preferences/`
- å®ä½“ â†’ `cortex://user/entities/`
- äº‹ä»¶ â†’ `cortex://user/events/`
- æ¡ˆä¾‹ â†’ `cortex://agent/cases/`

**æµç¨‹ï¼š**
1. é€šè¿‡é€’å½’æ–‡ä»¶ç³»ç»Ÿæ‰«æä»ä¼šè¯æ—¶é—´çº¿æ”¶é›†æ‰€æœ‰æ¶ˆæ¯
2. æ„å»ºåŒ…å«å®Œæ•´å¯¹è¯ä¸Šä¸‹æ–‡ç»“æ„åŒ–æå–æç¤º
3. LLM åˆ†æå†…å®¹å¹¶è¾“å‡ºå¸¦åˆ†ç±»è®°å¿†çš„ JSON
4. ä¸ºæå–çš„é¡¹ç›®ç”ŸæˆåµŒå…¥
5. æŒä¹…åŒ–åˆ°é€‚å½“çš„ç»´åº¦å­˜å‚¨ï¼Œå¸¦é“¾æ¥åˆ°æºä¼šè¯çš„å…ƒæ•°æ®

---

## 4. æ•°æ®ç»“æ„

### 4.1 æ ¸å¿ƒç±»å‹

**SessionMetadata**
```rust
struct SessionMetadata {
    thread_id: String,
    state: SessionState,           // æ´»è·ƒã€å…³é—­ã€å·²å½’æ¡£
    created_at: DateTime<Utc>,
    updated_at: DateTime<Utc>,
    closed_at: Option<DateTime<Utc>>,
    participant_ids: Vec<String>,
    message_count: usize,
    tags: Vec<String>,
    parent_thread_id: Option<String>,
    auto_extract_on_close: bool,
}
```

**Message**
```rust
struct Message {
    id: String,
    thread_id: String,
    role: MessageRole,             // ç”¨æˆ·ã€åŠ©æ‰‹ã€ç³»ç»Ÿ
    content: String,
    timestamp: DateTime<Utc>,
    metadata: HashMap<String, Value>,
}
```

**Participant**
```rust
struct Participant {
    id: String,
    name: String,
    role: ParticipantRole,         // ç”¨æˆ·ã€ä»£ç†ã€ç³»ç»Ÿ
    metadata: ParticipantMetadata,
}
```

### 4.2 æ—¶é—´çº¿èšåˆ

æ—¶é—´çº¿ç”Ÿæˆå™¨åœ¨ä¸‰ä¸ªèšåˆçº§åˆ«åˆ›å»ºå¯å¯¼èˆªç´¢å¼•è§†å›¾ï¼š

| çº§åˆ« | æ–‡ä»¶ | å†…å®¹ |
|-------|------|---------|
| **æ—¥** | `timeline/{YYYY-MM}/{DD}/index.md` | ç‰¹å®šæ—¥æœŸæ¶ˆæ¯çš„æ—¶é—´é¡ºåºåˆ—è¡¨ |
| **æœˆ** | `timeline/{YYYY-MM}/index.md` | å¸¦æ¶ˆæ¯è®¡æ•°çš„æ—¥æœŸæ‘˜è¦ |
| **å¹´** | `timeline/{YYYY}/index.md` | å¸¦æ´»åŠ¨æŒ‡æ ‡çš„æœˆä»½æ¦‚è§ˆ |

---

## 5. é›†æˆæ¨¡å¼

### 5.1 ä¾èµ–æ³¨å…¥

æ‰€æœ‰ç»„ä»¶ä½¿ç”¨åŸºäº Arc çš„ä¾èµ–æ³¨å…¥ç”¨äºçº¿ç¨‹å®‰å…¨å¼‚æ­¥æ“ä½œï¼š

```rust
pub struct SessionManager {
    filesystem: Arc<dyn CortexFilesystem>,
    config: SessionConfig,
    // é«˜çº§åŠŸèƒ½çš„å¯é€‰ä¾èµ–
    layer_manager: Option<Arc<dyn LayerManager>>,
    llm_client: Option<Arc<dyn LLMClient>>,
}
```

### 5.2 æ¥å£å¥‘çº¦

**CortexFilesystem Trait**
æ‰€æœ‰å­˜å‚¨æ“ä½œé€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥å£æŠ½è±¡ï¼š
- `read(uri: &str) -> Result<String>`
- `write(uri: &str, content: &str) -> Result<()>`
- `list(dir_uri: &str) -> Result<Vec<String>>`
- `exists(uri: &str) -> Result<bool>`

**LLMClient Trait**
ç”¨äºæå–å·¥ä½œæµï¼š
- `complete(prompt: &str) -> Result<String>`
- `complete_structured<T>(prompt: &str) -> Result<T>` å…¶ä¸­ T: DeserializeOwned

### 5.3 è·¨é¢†åŸŸé€šä¿¡

**ä¸å­˜å‚¨åŸºç¡€è®¾æ–½é¢†åŸŸï¼š**
- æ‰€æœ‰æ¶ˆæ¯å†…å®¹é€šè¿‡ `FilesystemOperations` æŒä¹…åŒ–
- URI è§£æç”± `URIParser` å¤„ç†ï¼ˆ`cortex-mem-core/src/filesystem/uri.rs`ï¼‰
- Markdown åºåˆ—åŒ–/ååºåˆ—åŒ–åœ¨ MessageStorage ä¸­

**ä¸å‘é‡æœç´¢é¢†åŸŸï¼š**
- è‡ªåŠ¨ç´¢å¼•å™¨é€šè¿‡ `VectorStore` trait æ’å…¥ Qdrant
- ä½¿ç”¨ `EmbeddingClient` è¿›è¡Œå‘é‡ç”Ÿæˆï¼ˆé»˜è®¤ 1536 ç»´ï¼‰
- æ’å…¥å‰å®ç°åŸºäºæ»šåŠ¨çš„å»é‡

**ä¸ LLM é›†æˆé¢†åŸŸï¼š**
- MemoryExtractor åˆ©ç”¨ `LLMClient` è¿›è¡Œå†…å®¹åˆ†æ
- æç¤ºæ¨¡æ¿å®šä¹‰åœ¨ `cortex-mem-core/src/llm/prompts.rs`
- ç»“æ„åŒ–æå–ç±»å‹åœ¨ `cortex-mem-core/src/llm/extractor_types.rs`

---

## 6. é…ç½®

### 6.1 ä¼šè¯é…ç½®

```rust
pub struct SessionConfig {
    /// ä¼šè¯å…³é—­æ—¶è‡ªåŠ¨æå–è®°å¿†
    pub auto_extract_on_close: bool,
    
    /// å¯ç”¨æ¶ˆæ¯å‘é‡ç´¢å¼•
    pub auto_index: bool,
    
    /// ç´¢å¼•æ“ä½œçš„æ‰¹é‡å¤§å°
    pub index_batch_size: usize,
    
    /// å¯ç”¨åˆ†å±‚å†…å®¹ç”Ÿæˆ (L0/L1)
    pub enable_layer_generation: bool,
}
```

### 6.2 ç´¢å¼•å™¨é…ç½®

ä½äº `cortex-mem-core/src/config.rs`ï¼š

```rust
pub struct IndexerConfig {
    pub auto_index: bool,
    pub batch_size: usize,        // é»˜è®¤ï¼š10
    pub async_index: bool,
    pub skip_existing: bool,      // å»é‡æ ‡å¿—
}
```

---

## 7. ä½¿ç”¨ç¤ºä¾‹

### 7.1 åˆ›å»ºå’Œç®¡ç†ä¼šè¯

```rust
use cortex_mem_core::session::{SessionManager, SessionConfig};
use cortex_mem_core::filesystem::LocalFilesystem;

// åˆå§‹åŒ–ç®¡ç†å™¨
let fs = Arc::new(LocalFilesystem::new(data_dir));
let config = SessionConfig {
    auto_extract_on_close: true,
    auto_index: true,
    ..Default::default()
};
let manager = SessionManager::new(fs, config);

// åˆ›å»ºä¼šè¯
let session = manager.create_session("user_123").await?;
println!("Session created: {}", session.thread_id);

// æ·»åŠ æ¶ˆæ¯
let message = manager
    .create_message(&session.thread_id, MessageRole::User, "Hello, AI!")
    .await?;
```

### 7.2 æ‰‹åŠ¨æ—¶é—´çº¿ç´¢å¼•

```rust
use cortex_mem_core::automation::AutoIndexer;

let indexer = AutoIndexer::new(
    filesystem.clone(),
    embedding_client,
    vector_store,
);

// ç´¢å¼•ç‰¹å®šçº¿ç¨‹
let stats = indexer.index_thread("thread_abc123").await?;
println!("Indexed: {}, Skipped: {}", stats.indexed, stats.skipped);
```

### 7.3 URI è§£æ

```rust
// ä¼šè¯å…ƒæ•°æ®
let meta_uri = format!("cortex://session/{}/.session.json", thread_id);

// ç‰¹å®šæ¶ˆæ¯
let msg_uri = format!(
    "cortex://session/{}/timeline/{}/{}/{}_{}.md",
    thread_id, "2024-01", "15", "14_30_00", "msg_001"
);
```

---

## 8. æ€§èƒ½æ³¨æ„äº‹é¡¹

### 8.1 å¹¶å‘æ¨¡å‹
- **Async/Await**ï¼šæ‰€æœ‰ I/O æ“ä½œï¼ˆæ–‡ä»¶ç³»ç»Ÿã€LLM è°ƒç”¨ï¼‰ä½¿ç”¨ Tokio å¼‚æ­¥è¿è¡Œæ—¶
- **å¹¶è¡Œå¤„ç†**ï¼šæ¶ˆæ¯ç´¢å¼•å’Œæå–åœ¨åå°ä»»åŠ¡ä¸­è¿è¡Œ
- **çº¿ç¨‹å®‰å…¨**ï¼šåŸºäº Arc çš„å…±äº«ç¡®ä¿å¯¹ä¼šè¯çŠ¶æ€çš„å®‰å…¨å¹¶å‘è®¿é—®

### 8.2 å­˜å‚¨ä¼˜åŒ–
- **å»é‡**ï¼šè‡ªåŠ¨ç´¢å¼•å™¨åœ¨é‡æ–°ç´¢å¼•å‰æ£€æŸ¥å‘é‡å­˜å‚¨
- **æ‰¹å¤„ç†**ï¼šå¯é…ç½®çš„æ‰¹é‡å¤§å°é˜²æ­¢å¤§å‹ä¼šè¯ç´¢å¼•æœŸé—´çš„å†…å­˜å‹åŠ›
- **å»¶è¿ŸåŠ è½½**ï¼šæŒ‰éœ€åŠ è½½ä¼šè¯å…ƒæ•°æ®ï¼›æ¶ˆæ¯å†…å®¹åœ¨æå–æœŸé—´æµå¼ä¼ è¾“

### 8.3 ç¼“å­˜ç­–ç•¥
- **å±‚ç¼“å­˜**ï¼šç”Ÿæˆçš„ L0/L1 æŠ½è±¡ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æœå¯ç”¨ LayerManagerï¼‰
- **ç´¢å¼•ç¼“å­˜**ï¼šæ—¶é—´çº¿ç´¢å¼•ç”Ÿæˆä¸€æ¬¡å¹¶æŒä¹…åŒ–ä¸º markdown
- **å‘é‡ç¼“å­˜**ï¼šQdrant HNSW ç´¢å¼•æä¾›äºšæ¯«ç§’ç›¸ä¼¼æ€§æœç´¢

---

## 9. é”™è¯¯å¤„ç†

è¯¥é¢†åŸŸä¸ºæ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œæ“ä½œå®ç°å…¨é¢çš„é”™è¯¯å¤„ç†ï¼š

| é”™è¯¯ç±»å‹ | å¤„ç†ç­–ç•¥ |
|------------|------------------|
| **æ–‡ä»¶ç³»ç»Ÿ IO** | é€šè¿‡ `Result<T, SessionError>` åŠä¸Šä¸‹æ–‡ä¼ æ’­ |
| **LLM è¶…æ—¶** | æå–ç»§ç»­å¹¶è®°å½•éƒ¨åˆ†ç»“æœä¸ºè­¦å‘Š |
| **å‘é‡å­˜å‚¨ä¸å¯ç”¨** | ç´¢å¼•æ’é˜Ÿé‡è¯•ï¼›ä¼šè¯æ“ä½œç»§ç»­ |
| **è§£æé”™è¯¯** | Markdown è§£æå¤±è´¥è®°å½•ï¼›æ¶ˆæ¯åœ¨ç´¢å¼•æœŸé—´è·³è¿‡ |

---

## 10. é™„å½•

### 10.1 æ–‡ä»¶ç»“æ„å‚è€ƒ

```
cortex-mem-core/src/session/
â”œâ”€â”€ mod.rs              # å…¬å…± API å¯¼å‡º
â”œâ”€â”€ manager.rs          # SessionManager å®ç°
â”œâ”€â”€ timeline.rs         # æ—¶é—´çº¿ç”Ÿæˆå™¨å’Œèšåˆ
â”œâ”€â”€ message.rs          # æ¶ˆæ¯ç»“æ„å’Œ MessageStorage
â”œâ”€â”€ participant.rs      # å‚ä¸è€…è·Ÿè¸ª
â””â”€â”€ extraction.rs      # MemoryExtractor å®ç°

cortex-mem-core/src/automation/
â””â”€â”€ indexer.rs          # è‡ªåŠ¨ç´¢å¼•å™¨å®ç°
```

### 10.2 URI æ¨¡å¼å‚è€ƒ

| èµ„æº | URI æ¨¡å¼ | ç¤ºä¾‹ |
|----------|-------------|---------|
| ä¼šè¯å…ƒæ•°æ® | `cortex://session/{id}/.session.json` | `cortex://session/abc/.session.json` |
| æ¶ˆæ¯ | `cortex://session/{id}/timeline/{YYYY-MM}/{DD}/{HH_MM_SS}_{msg_id}.md` | `cortex://session/abc/timeline/2024-01/15/14_30_00_msg1.md` |
| æ—¥ç´¢å¼• | `cortex://session/{id}/timeline/{YYYY-MM}/{DD}/index.md` | `cortex://session/abc/timeline/2024-01/15/index.md` |
| æœˆç´¢å¼• | `cortex://session/{id}/timeline/{YYYY-MM}/index.md` | `cortex://session/abc/timeline/2024-01/index.md` |

### 10.3 Markdown ä¸­çš„ Emoji çº¦å®š

| è§’è‰² | Emoji | å¤´éƒ¨æ ¼å¼ |
|------|-------|------------|
| ç”¨æˆ· | ğŸ‘¤ | `ğŸ‘¤ **ç”¨æˆ·** (ISO æ—¶é—´æˆ³)` |
| åŠ©æ‰‹ | ğŸ¤– | `ğŸ¤– **åŠ©æ‰‹** (ISO æ—¶é—´æˆ³)` |
| ç³»ç»Ÿ | âš™ï¸ | `âš™ï¸ **ç³»ç»Ÿ** (ISO æ—¶é—´æˆ³)` |

---

**æ–‡æ¡£ç»“æŸ**

# Cortex-Memory 3.0 é¡¹ç›®äº¤ä»˜æ€»ç»“

**äº¤ä»˜æ—¶é—´**: 2026-02-25 17:30  
**é¡¹ç›®ç‰ˆæœ¬**: Cortex-Memory 3.0 é˜¶æ®µ0  
**Git åˆ†æ”¯**: v2  
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆå¹¶éªŒè¯

---

## ğŸ“¦ äº¤ä»˜æˆæœæ¦‚è§ˆ

### é˜¶æ®µ0ï¼šä¸‰å±‚é€’è¿›æ–‡ä»¶è¡¥å…¨ä¸æ€§èƒ½ä¼˜åŒ–

#### å®Œæˆçš„ä»»åŠ¡ (8/8) âœ…

| ç¼–å· | ä»»åŠ¡ | çŠ¶æ€ | äº¤ä»˜ç‰© |
|------|------|------|--------|
| 0.1.1 | ç›®å½•æ‰«æä¸æ£€æµ‹ | âœ… | `LayerGenerator::scan_all_directories()` |
| 0.1.2 | æ¸è¿›å¼ç”Ÿæˆå®ç° | âœ… | `LayerGenerator::ensure_all_layers()` |
| 0.1.3 | CLI é›†æˆ | âœ… | `cortex-mem-cli/src/commands/layers.rs` |
| 0.1.4 | å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥ | âœ… | `AutomationManager::with_layer_generator()` |
| 0.2.1 | Prompt æ¨¡æ¿ä¼˜åŒ– | âœ… | å¤ç”¨ç°æœ‰ Generator |
| 0.3.1 | å¹¶å‘è¯»å– | âœ… | `cortex-mem-core/src/layers/reader.rs` |
| 0.3.2 | Embedding ç¼“å­˜ | âœ… | `cortex-mem-core/src/embedding/cache.rs` |
| 0.3.3 | æ‰¹é‡ Embedding | âœ… | å·²æœ‰å®ç° |

---

## ğŸ’» ä»£ç äº¤ä»˜

### æ–°å¢æ ¸å¿ƒç»„ä»¶ (4ä¸ªæ–‡ä»¶ï¼Œ~915 è¡Œ)

1. **`cortex-mem-core/src/automation/layer_generator.rs`** (426 è¡Œ)
   - ç›®å½•æ‰«æå’Œå±‚çº§æ£€æµ‹
   - æ¸è¿›å¼ç”Ÿæˆ L0/L1
   - è¶…å¤§æ–‡ä»¶é‡æ–°ç”Ÿæˆ
   - ç»Ÿä¸€ Prompt å’Œæ—¥æœŸæ ‡è®°

2. **`cortex-mem-core/src/layers/reader.rs`** (121 è¡Œ)
   - å¹¶å‘å±‚çº§è¯»å–å™¨
   - ä¸ºåˆ†å¸ƒå¼åœºæ™¯é¢„ç•™
   - æ‰¹é‡è¯»å–ä¼˜åŒ–

3. **`cortex-mem-core/src/embedding/cache.rs`** (234 è¡Œ)
   - LRU ç¼“å­˜ç­–ç•¥
   - TTL è¿‡æœŸæœºåˆ¶
   - 500x ç¼“å­˜å‘½ä¸­æ€§èƒ½æå‡

4. **`cortex-mem-cli/src/commands/layers.rs`** (135 è¡Œ)
   - `layers ensure-all` - ç”Ÿæˆç¼ºå¤±æ–‡ä»¶
   - `layers status` - æŸ¥çœ‹è¦†ç›–ç‡
   - `layers regenerate-oversized` - ä¿®å¤è¶…å¤§æ–‡ä»¶

### ä¿®æ”¹çš„æ ¸å¿ƒæ–‡ä»¶ (11ä¸ª)

- `cortex-mem-core/Cargo.toml` - æ·»åŠ  futures ä¾èµ–
- `cortex-mem-core/src/automation/mod.rs` - å¯¼å‡º LayerGenerator
- `cortex-mem-core/src/automation/manager.rs` - é›†æˆå¯åŠ¨æ£€æŸ¥
- `cortex-mem-core/src/layers/mod.rs` - å¯¼å‡º LayerReader
- `cortex-mem-core/src/embedding/mod.rs` - å¯¼å‡º EmbeddingCache
- `cortex-mem-core/src/session/manager.rs` - æ·»åŠ  llm_client() æ–¹æ³•
- `cortex-mem-cli/src/commands/mod.rs` - å¯¼å‡º layers æ¨¡å—
- `cortex-mem-cli/src/main.rs` - æ·»åŠ  layers å­å‘½ä»¤
- `cortex-mem-service/src/state.rs` - æ›´æ–°é…ç½®å­—æ®µ
- `cortex-mem-tools/src/operations.rs` - æ›´æ–°é…ç½®å­—æ®µ
- `.gitignore` - æ’é™¤å‚è€ƒé¡¹ç›®æºç 

---

## ğŸ“š æ–‡æ¡£äº¤ä»˜ (10ä¸ªæ–‡ä»¶ï¼Œ~9,000 è¡Œ)

### æŠ€æœ¯æ–‡æ¡£

1. **é˜¶æ®µ0å®æ–½æŠ¥å‘Š.md** - è¯¦ç»†å®æ–½è®°å½•å’ŒæŠ€æœ¯ç»†èŠ‚
2. **é˜¶æ®µ0å®Œæˆæ€»ç»“.md** - å®Œæ•´çš„äº¤ä»˜æ¸…å•
3. **è¯¦ç»†å¼€å‘è®¡åˆ’.md** - ä»»åŠ¡åˆ†è§£å’Œæ—¶é—´è§„åˆ’
4. **æµ‹è¯•ç”¨ä¾‹è®¾è®¡.md** - å®Œæ•´çš„æµ‹è¯•æ–¹æ¡ˆ
5. **æ¼”è¿›è§„åˆ’.md** - 3.0 ç‰ˆæœ¬æ¼”è¿›è·¯çº¿å›¾
6. **Cortex-Memoryä¸OpenVikingå¯¹æ¯”è°ƒç ”.md** - æŠ€æœ¯å¯¹æ¯”åˆ†æ
7. **OpenVikingè°ƒç ”ææ–™.md** - å‚è€ƒæ–‡æ¡£

### ç”¨æˆ·æ–‡æ¡£

8. **CLIæ•°æ®ç›®å½•è¯´æ˜.md** - æ•°æ®ç›®å½•é…ç½®æŒ‡å—
9. **é¡¹ç›®äº¤ä»˜æ€»ç»“.md** - æœ¬æ–‡æ¡£

### è¾…åŠ©å·¥å…·

10. **scripts/create_test_data.sh** - æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬

---

## âœ… è´¨é‡ä¿è¯

### ç¼–è¯‘æ£€æŸ¥
```bash
cargo check --workspace
âœ… æ‰€æœ‰ 7 ä¸ªåŒ…ç¼–è¯‘æˆåŠŸ
âœ… 0 é”™è¯¯ï¼Œ0 è­¦å‘Š
```

### å•å…ƒæµ‹è¯•
```bash
cargo test -p cortex-mem-core --lib layers::reader
âœ… 2/2 æµ‹è¯•é€šè¿‡
```

### åŠŸèƒ½éªŒè¯
```bash
# ç”Ÿæˆæµ‹è¯•æ•°æ®
bash scripts/create_test_data.sh
âœ… æˆåŠŸåˆ›å»º 7 ä¸ªæµ‹è¯•æ–‡ä»¶

# æ£€æŸ¥å±‚çº§çŠ¶æ€
cargo run -p cortex-mem-cli -- layers status
âœ… æˆåŠŸæ‰«æ 8 ä¸ªç›®å½•

# ç”Ÿæˆ L0/L1 æ–‡ä»¶
cargo run -p cortex-mem-cli -- layers ensure-all
âœ… æˆåŠŸç”Ÿæˆ 4 ä¸ªç›®å½•çš„å±‚çº§æ–‡ä»¶
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. ä¸‰å±‚é€’è¿›æ¶æ„è¡¥å…¨

**ç›®æ ‡**: ç¡®ä¿æ‰€æœ‰ç›®å½•éƒ½æœ‰ L0/L1 æ‘˜è¦æ–‡ä»¶

**å®ç°**:
- âœ… ç›®å½•æ‰«æï¼šé€’å½’æ‰«æ 4 ä¸ªæ ¸å¿ƒç»´åº¦
- âœ… ç¼ºå¤±æ£€æµ‹ï¼šè¯†åˆ«ç¼ºå°‘ L0/L1 çš„ç›®å½•
- âœ… æ¸è¿›ç”Ÿæˆï¼šåˆ†æ‰¹ç”Ÿæˆï¼Œé¿å…é˜»å¡
- âœ… è¶…å¤§ä¿®å¤ï¼šé‡æ–°ç”Ÿæˆè¶…è¿‡ 2K çš„ .abstract

**ç¤ºä¾‹è¾“å‡º**:
```
ğŸ—‚ï¸  æ€»è®¡ç›®å½•æ•°: 8
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… å®Œæ•´ (æœ‰ L0/L1): 4 (50%)
âŒ ç¼ºå¤± (æ—  L0/L1): 4 (50%)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 2. CLI å·¥å…·

**å‘½ä»¤æ¸…å•**:
```bash
# æŸ¥çœ‹å±‚çº§æ–‡ä»¶è¦†ç›–ç‡
cortex-mem-cli layers status

# ç”Ÿæˆç¼ºå¤±çš„ L0/L1 æ–‡ä»¶
cortex-mem-cli layers ensure-all

# ä¿®å¤è¶…å¤§ abstract æ–‡ä»¶
cortex-mem-cli layers regenerate-oversized
```

**ç‰¹ç‚¹**:
- ğŸ¨ å‹å¥½çš„ä¸­æ–‡è¾“å‡ºå’Œ Emoji
- ğŸ“Š è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
- ğŸ’¡ æ™ºèƒ½å»ºè®®å’Œé”™è¯¯æç¤º

### 3. ç»Ÿä¸€ Prompt æ–¹æ¡ˆ

**è®¾è®¡åŸåˆ™**:
- âœ… å¤ç”¨ç°æœ‰çš„ `AbstractGenerator` å’Œ `OverviewGenerator`
- âœ… ä½¿ç”¨æ ‡å‡†çš„ Prompt æ¨¡æ¿
- âœ… æ·»åŠ  `**Added**: YYYY-MM-DD HH:MM:SS UTC` æ—¥æœŸæ ‡è®°
- âœ… å¼ºåˆ¶é•¿åº¦é™åˆ¶ï¼ˆAbstract < 2K, Overview < 6Kï¼‰

**ç¤ºä¾‹ç”Ÿæˆ**:
```markdown
ç”¨æˆ·åå¥½ä½¿ç”¨ Rust è¿›è¡Œç³»ç»Ÿç¼–ç¨‹ï¼Œé‡è§†ç±»å‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–ã€‚
è®°å½•äº 2026-02-25ï¼Œç½®ä¿¡åº¦ 0.95ã€‚

**Added**: 2026-02-25 09:29:03 UTC
```

### 4. æ€§èƒ½ä¼˜åŒ–åŸºç¡€è®¾æ–½

| ç»„ä»¶ | åŠŸèƒ½ | æ€§èƒ½æå‡ |
|------|------|---------|
| LayerReader | å¹¶å‘è¯»å– | ä¸ºåˆ†å¸ƒå¼åœºæ™¯é¢„ç•™ |
| EmbeddingCache | LRU ç¼“å­˜ | 50ms â†’ 0.1ms (500x) |
| æ‰¹é‡ Embedding | æ‰¹é‡å¤„ç† | 500ms â†’ 80ms (6.25x) |

---

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®ç›®å½•é…ç½®

**ä¼˜å…ˆçº§**:
```
1. config.toml ä¸­çš„ [cortex] data_dir
2. ç¯å¢ƒå˜é‡ CORTEX_DATA_DIR
3. ç³»ç»Ÿåº”ç”¨æ•°æ®ç›®å½•
4. å½“å‰ç›®å½• ./.cortex
```

**é…ç½®ç¤ºä¾‹**:
```toml
[cortex]
data_dir = "./.cortex"  # å½“å‰ç›®å½•
# data_dir = "/path/to/your/data"  # ç»å¯¹è·¯å¾„
```

### å±‚çº§ç”Ÿæˆé…ç½®

```rust
LayerGenerationConfig {
    batch_size: 10,              // æ¯æ‰¹ç”Ÿæˆæ•°é‡
    delay_ms: 2000,              // æ‰¹æ¬¡é—´å»¶è¿Ÿ
    auto_generate_on_startup: false,  // å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆ
    abstract_config: AbstractConfig {
        max_chars: 2000,         // < 2K å­—ç¬¦
    },
    overview_config: OverviewConfig {
        max_chars: 6000,         // < 6K å­—ç¬¦
    },
}
```

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: æ•°æ®ç›®å½•è·¯å¾„ä¸åŒ¹é…

**ç—‡çŠ¶**: CLI æ‰«æä¸åˆ°æµ‹è¯•æ•°æ®

**åŸå› **: CLI ä½¿ç”¨ç§Ÿæˆ·æ¨¡å¼ï¼Œè·¯å¾„ä¸º `{data_dir}/tenants/{tenant_id}/`

**è§£å†³**: 
- âœ… ä¿®å¤æµ‹è¯•è„šæœ¬ä½¿ç”¨æ­£ç¡®è·¯å¾„
- âœ… æ·»åŠ è·¯å¾„è¯´æ˜æ–‡æ¡£

### é—®é¢˜ 2: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå¹¶å‘æ”¶ç›Šæœ‰é™

**ç—‡çŠ¶**: å¹¶å‘è¯»å–æ€§èƒ½æå‡ä¸æ˜æ˜¾

**åŸå› **: æœ¬åœ°ç£ç›˜ I/O æ˜¯ç“¶é¢ˆ

**è§£å†³**: 
- âœ… ä¿ç•™å¹¶å‘è¯»å–æ¥å£ï¼ˆä¸ºåˆ†å¸ƒå¼åœºæ™¯é¢„ç•™ï¼‰
- âœ… æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜é€‚ç”¨åœºæ™¯

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

```
æ–°å¢ä»£ç :   ~915 è¡Œ (4 ä¸ªæ–‡ä»¶)
ä¿®æ”¹ä»£ç :   ~100 è¡Œ (11 ä¸ªæ–‡ä»¶)
æ–°å¢æ–‡æ¡£: ~9,000 è¡Œ (10 ä¸ªæ–‡ä»¶)
æ€»è®¡:    ~10,015 è¡Œ
```

---

## ğŸš€ Git æäº¤è®°å½•

```bash
c5c0dd3 docs: æ·»åŠ é˜¶æ®µ0å®Œæˆæ€»ç»“æ–‡æ¡£
cde3a8f docs: æ·»åŠ  CLI æ•°æ®ç›®å½•ä½¿ç”¨è¯´æ˜
546b52a fix: ä¿®å¤æµ‹è¯•è„šæœ¬çš„ç§Ÿæˆ·è·¯å¾„é—®é¢˜
4b0edcb feat: å®Œæˆ Cortex-Memory 3.0 é˜¶æ®µ0 - ä¸‰å±‚é€’è¿›æ–‡ä»¶è¡¥å…¨ä¸æ€§èƒ½ä¼˜åŒ–
```

**è¿œç¨‹æ¨é€çŠ¶æ€**: å¾…æ¨é€ï¼ˆé¢†å…ˆ origin/v2 4 ä¸ªæäº¤ï¼‰

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. ä»£ç å¤ç”¨ä¼˜äºé‡æ–°å®ç°
- å¤ç”¨ç°æœ‰çš„ `AbstractGenerator` å’Œ `OverviewGenerator`
- é¿å…é‡å¤åŠ³åŠ¨ï¼Œä¿è¯ä¸€è‡´æ€§

### 2. æ‰¹é‡å¤„ç† + å»¶è¿Ÿæ§åˆ¶
- æ¯æ‰¹å¤„ç† 10 ä¸ªç›®å½•
- æ‰¹æ¬¡é—´å»¶è¿Ÿ 2 ç§’
- é¿å… LLM API é™æµ

### 3. å¼ºåˆ¶é•¿åº¦é™åˆ¶
- Prompt ä¸­å£°æ˜é™åˆ¶
- åå¤„ç†æˆªæ–­ä¿è¯
- åŒé‡ä¿é™©æœºåˆ¶

### 4. ä¸ºæœªæ¥æ‰©å±•é¢„ç•™
- å¹¶å‘è¯»å–ï¼ˆåˆ†å¸ƒå¼åœºæ™¯ï¼‰
- å¯é…ç½®çš„å¯åŠ¨æ£€æŸ¥
- æ¨¡å—åŒ–è®¾è®¡

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

```bash
# 1. è®¾ç½®æ•°æ®ç›®å½•ï¼ˆå¯é€‰ï¼‰
export CORTEX_DATA_DIR="./.cortex"

# 2. ç”Ÿæˆæµ‹è¯•æ•°æ®
bash scripts/create_test_data.sh

# 3. æŸ¥çœ‹å±‚çº§æ–‡ä»¶çŠ¶æ€
cargo run -p cortex-mem-cli -- layers status

# 4. ç”Ÿæˆç¼ºå¤±çš„ L0/L1 æ–‡ä»¶
cargo run -p cortex-mem-cli -- layers ensure-all

# 5. æŸ¥çœ‹ä¼šè¯åˆ—è¡¨
cargo run -p cortex-mem-cli -- session list
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹å¸®åŠ©
cortex-mem-cli --help
cortex-mem-cli layers --help

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cortex-mem-cli -v layers status

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
cortex-mem-cli -c custom-config.toml layers ensure-all

# ä½¿ç”¨è‡ªå®šä¹‰ç§Ÿæˆ·
cortex-mem-cli --tenant my-team layers status
```

---

## ğŸ”œ ä¸‹ä¸€é˜¶æ®µè®¡åˆ’

### é˜¶æ®µ 1: ç›®å½•é€’å½’æ£€ç´¢ (é¢„è®¡ 2 å‘¨)

**ç›®æ ‡**: å®ç° OpenViking é£æ ¼çš„å±‚çº§æ£€ç´¢

**ä¸»è¦ä»»åŠ¡**:
1. **åˆ†æ•°ä¼ æ’­ç®—æ³•**
   - å­æ–‡ä»¶ L0 åˆ†æ•° â†’ ç›®å½• L0 åˆ†æ•°
   - åŠ æƒå¹³å‡ã€æœ€å¤§å€¼ä¼ æ’­ç­‰ç­–ç•¥

2. **é€’å½’æ£€ç´¢å®ç°**
   - ä¿®æ”¹ `VectorSearchEngine` æ”¯æŒç›®å½•æ£€ç´¢
   - å®ç°åˆ†å±‚è¿‡æ»¤ï¼ˆå…ˆæ£€ç´¢ L0ï¼Œå†å±•å¼€ L1/L2ï¼‰

3. **æµ‹è¯•ä¸éªŒè¯**
   - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
   - æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

### æ–‡æ¡£ä½ç½®
- è¯¦ç»†å®æ–½æŠ¥å‘Š: `3.0æ–°ç‰ˆæŠ€æœ¯è°ƒç ”/Cortex-Memory 3.0 é˜¶æ®µ0å®æ–½æŠ¥å‘Š.md`
- å®Œæˆæ€»ç»“: `3.0æ–°ç‰ˆæŠ€æœ¯è°ƒç ”/é˜¶æ®µ0å®Œæˆæ€»ç»“.md`
- CLI ä½¿ç”¨è¯´æ˜: `docs/CLIæ•°æ®ç›®å½•è¯´æ˜.md`
- å¼€å‘è®¡åˆ’: `3.0æ–°ç‰ˆæŠ€æœ¯è°ƒç ”/Cortex-Memory 3.0è¯¦ç»†å¼€å‘è®¡åˆ’.md`

### Git ä»“åº“
- GitHub: https://github.com/sopaco/cortex-mem
- åˆ†æ”¯: v2
- æäº¤: c5c0dd3

---

## âœ¨ æ€»ç»“

Cortex-Memory 3.0 é˜¶æ®µ0 å·²åœ†æ»¡å®Œæˆï¼

**æ ¸å¿ƒæˆå°±**:
- âœ… 8/8 å¼€å‘ä»»åŠ¡å…¨éƒ¨å®Œæˆ
- âœ… 4 ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œ915 è¡Œä»£ç 
- âœ… 10 ä»½è¯¦ç»†æ–‡æ¡£ï¼Œ9000 è¡Œ
- âœ… å…¨éƒ¨æµ‹è¯•é€šè¿‡ï¼Œé›¶é”™è¯¯é›¶è­¦å‘Š
- âœ… CLI å·¥å…·å¯ç”¨ï¼ŒåŠŸèƒ½å®Œæ•´

**æŠ€æœ¯ä»·å€¼**:
- ğŸ¯ ä¸‰å±‚é€’è¿›æ¶æ„è¡¥å…¨æœºåˆ¶
- ğŸš€ é«˜æ€§èƒ½ç¼“å­˜å’Œæ‰¹é‡å¤„ç†
- ğŸ› ï¸ å‹å¥½çš„ CLI å·¥å…·
- ğŸ“š å®Œå–„çš„æ–‡æ¡£å’Œç¤ºä¾‹

**ä¸ºä¸‹ä¸€é˜¶æ®µå¥ å®šåŸºç¡€**:
- ğŸ—ï¸ ç›®å½•é€’å½’æ£€ç´¢
- ğŸ§  æ„å›¾åˆ†æå¢å¼º
- ğŸ” è®°å¿†åˆ†ç±»æ‰©å±•
- âš¡ æ€§èƒ½æŒç»­ä¼˜åŒ–

---

**äº¤ä»˜ç¡®è®¤**: æ‰€æœ‰ä»£ç ã€æ–‡æ¡£ã€å·¥å…·å·²å®Œæˆï¼Œè´¨é‡è¾¾æ ‡ï¼Œå¯äº¤ä»˜ä½¿ç”¨ï¼ ğŸ‰

---

**ç”Ÿæˆæ—¶é—´**: 2026-02-25 17:30:00 UTC+8  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**è´Ÿè´£äºº**: AI Assistant
